var promId="a41a5263";var doSignUrl="//hd"+cookieDomain+"/promotion/signIntegral/website/sign/doSign.do";var getSignIntegralInfoUrl="//hd"+cookieDomain+"/promotion/signIntegral/website/sign/getSignIntegralInfo.do";var doExchangeUrl="//hd"+cookieDomain+"/promotion/signIntegral/website/sign/doExchange.do";var acScrollTime=null;$.fn.scrollForever=function(e){var t={placeholder:0,dir:"left",container:"ul",inner:"li",speed:1e3,delayTime:0,continuous:true,num:1};var n=$.extend({},t,e);var a=n.placeholder;var i=n.dir;var l=n.speed;var r=n.Time;var o=n.num;var c=n.delayTime;return this.each(function(){var e=$(this);var t=e.find(n.container);var r=t.find(n.inner);var s=r.length;var d,g;function u(){if(n.continuous){if(i=="left"){d=r.outerWidth()*s;t.css("width",2*d);r.clone().appendTo(t)}else if(i=="top"){d=r.outerHeight()*s;t.css("height",2*d);r.clone().appendTo(t)}}else{if(i=="left"){a=a!=0?a:r.outerWidth()*o;d=r.outerWidth()*(s+1);t.css("width",d)}else if(i=="top"){a=a!=0?a:r.outerHeight()*o;d=r.outerHeight()*(s+1);t.css("height",d)}}}u();function m(){if(n.continuous){if(i=="left"){g=e.scrollLeft();if(g>=d){e.scrollLeft(0)}else{e.scrollLeft(g+1)}}else if(i=="top"){g=e.scrollTop();if(g>=d){e.scrollTop(0)}else{e.scrollTop(g+1)}}}else{if(i=="left"){t.animate({marginLeft:"-"+a},l,function(){t.css({marginLeft:0}).find(n.inner+":lt("+o+")").appendTo(t)})}else if(i=="top"){t.animate({marginTop:"-"+a},l,function(){t.css({marginTop:0}).find(n.inner+":lt("+o+")").appendTo(t)})}}}var h=n.continuous==true?20:2e3;c=c==0?h:c;clearInterval(acScrollTime);acScrollTime=setInterval(m,c);e.hover(function(){clearInterval(acScrollTime)},function(){acScrollTime=setInterval(m,c)})})};var util={trim:function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},strToArr:function(e,t){return e.split(t)},fitPlaceholder:function(){if($.browser.version&&$.browser.version<10){var e=document.getElementsByTagName("input"),t="placeholder"in document.createElement("input"),n=function(e){var t=e.getAttribute("placeholder"),n=e.defaultValue;if(n==""){e.value=t}e.onfocus=function(){if(e.value===t)this.value=""};e.onblur=function(){if(e.value==="")this.value=t}};if(!t){for(var a=0,i=e.length;a<i;a++){var l=e[a],r=l.getAttribute("placeholder");if(l.type==="text"&&r){n(l)}}}}},double12Toast:function(e){var t=document.createElement("div");t.className=e.elName+" double12model";var n=document.createElement("div");n.className="close btn";var a=document.createElement("div");a.className="model-title";a.innerHTML=e.title||"确定";var i=document.createElement("div");i.className="model-container";var l=document.createElement("div");l.className="model-container-text-error";l.innerHTML=e.conTextError||"";var r=document.createElement("div");r.className="model-container-text";var o=document.createElement("span");o.innerHTML=e.conTextL||"";o.className="model-container-text-l";var c=document.createElement("span");c.innerHTML=e.conTextR||"";c.className="model-container-text-r";var s=document.createElement("div");s.className="model-container-subtext";s.innerHTML=e.subcontent||"";var d=document.createElement("a");d.setAttribute("href",e.urlLink||"");d.setAttribute("target","_blank");d.setAttribute("data-code","201812qu-4");d.className="model-container-urltext";d.innerHTML=e.urltext||"";var g=document.createElement("div");g.className="model-foot";var u=document.createElement("button");u.className="btn";u.innerHTML=e.btnText||"确定";var m=document.createElement("div");m.className="double12model-bg";t.style.left=document.body.clientWidth/2-190+"px";m.style.width=document.body.clientWidth+"px";m.style.height=document.body.clientHeight+"px";t.appendChild(n);t.appendChild(a);t.appendChild(i);i.appendChild(l);i.appendChild(r);r.appendChild(o);r.appendChild(c);i.appendChild(s);i.appendChild(d);t.appendChild(g);g.appendChild(u);document.body.appendChild(m);document.body.appendChild(t)},confirmClick:function(e){this.double12Toast(e);var t=$(".double12model");var n=$(".double12model-bg");var a=null;a=setTimeout(function(){n.css("dispaly","block");t.addClass("double12model-slide");clearTimeout(a)},300);var i=t.find(".btn");this.modelBtnClick({btn:i,arr:[n,t],callback:e.callback})},hasModelFlag:false,modelBtnClick:function(e){var t=this;e.btn.bind("click",function(){for(var n=0;n<e.arr.length;n++){e.arr[n].remove()}t.hasModelFlag=false;e.callback&&e.callback()})},alert:function(e){e.title=e.title||"提示";e.elName=e.elName||"sign_success_2";e.conTextL=e.conTextL||"";e.conTextError=e.conTextL||"返回数据错误！";e.conTextR=e.conTextR||"";e.btnText=e.btnText||"确定";e.subcontent=e.subcontent||"";this.confirmClick(e)},calender:function(e){var t=document.getElementById(e.id);t.innerHTML="";var n=new Date;n.setMonth(parseInt(e.month)-1);n.setDate(1);var a=n.getDay();if(a==0)a=7;for(var i=0;i<a;i++){var l=document.createElement("li");l.className="blank";t.appendChild(l)}for(var i=0;i<e.startDate-1;i++){var l=document.createElement("li");var r=document.createElement("div");r.className="date";l.appendChild(r);r.innerHTML=e.month+"月";var o=document.createElement("div");o.className="date-before";l.appendChild(o);o.innerHTML=i+1;t.appendChild(l)}for(var i=e.startDate-1;i<e.endDate;i++){var l=document.createElement("li");var c=document.createElement("div");c.className="date";l.appendChild(c);c.innerHTML=e.month+"月"+(i+1)+"日";l.className="sign-day";if(i+1>=e.changeStartDate&&i+1<=e.changeEndDate){l.className+=" exchange-sign-day"}t.appendChild(l)}var n=new Date(parseInt(e.year),parseInt(e.month)-1,parseInt(e.endDate));var s=n.getDay();var d=new Date(parseInt(e.year),parseInt(e.month),0);var g=d.getDate();if(s<6){for(var i=0;i<7-s-1;i++){var l=document.createElement("li");var u=document.createElement("div");u.className="date";l.appendChild(u);u.innerHTML=e.month+"月";var m=document.createElement("div");m.className="date-after";l.appendChild(m);m.innerHTML=i+1+(e.endDate-0);if(i+1+(e.endDate-0)<=g){t.appendChild(l)}}}},login:function(e){if(loginData.loginStatus&&loginData.loginStatus<3){$.ajax({url:stageJsServer+"/gmlib/unit/g/1.0.0/g.min.js",dataType:"script",cache:true,success:function(){g.login(function(){e()})}})}}};function getSignIntegralInfo(e,t,n,a){var n=$(n);var a=$(a);i();function i(){$.ajax({url:e,type:"get",dataType:"JSONP",data:{promId:t},success:function(e){if(e.state=="end"){$(".ac-container").html("");$(".ac-container").addClass("ac-container-end")}else if(e.state=="no_login"||e.state=="success"){a.show();util.calender({id:"calender",year:util.strToArr(e.startDate,"-")[0],month:util.strToArr(e.startDate,"-")[1],startDate:util.strToArr(e.startDate,"-")[2],endDate:util.strToArr(e.endDate,"-")[2],changeStartDate:util.strToArr(e.exchangeStartDate,"-")[2],changeEndDate:util.strToArr(e.exchangeEndDate,"-")[2]});var t=n.find(".sign-day");if(e.exchangeData&&e.exchangeData.length){var i="";$(".exchange-list ul").html("");for(var l=0;l<e.exchangeData.length;l++){i+="<li>"+e.exchangeData[l]+"</li>"}$(".exchange-list ul").append(i);$(".exchange-list").show();$(".exchange-list").scrollForever({continuous:false,dir:"top",container:"ul",inner:"li",delayTime:3e3})}else{$(".exchange-list").hide()}if(e.userSignState==1){$("#signBtn").removeClass("signedBtn").addClass("signBtnClick").html("立即签到")}else{$("#signBtn").addClass("signedBtn").removeClass("signBtnClick").html("今日已签到");$("#signBtn").unbind("click")}$(".signed-days").find(".day").html(e.signDays);$(".exchange-points").find(".points").html(e.userIntegral);if(e.userIntegral>10){$(".exchange-points").find(".cur-yuan").html("您可兑换<span class='yuan'>"+e.exchangeAmount+"</span>元代金券哦")}else{$(".exchange-points").find(".cur-yuan").html("每10积分可以兑换1元代金券哦")}$(".exchange-points").find(".yuan").html(e.exchangeAmount);if(e.exchangeState&&e.exchangeState==1){$(".exchange-btn").removeClass("canntexchange-btn")}else{$(".exchange-btn").addClass("canntexchange-btn")}$(".exchange-btns").find(".exchange-input").attr("placeholder","请输入兑换的积分数量");$(".canntexchange-btn").find(".exchange-input").attr({placeholder:"兑换时间未到",disabled:"disabled"});$(".canntexchange-btn").find(".exBtn").unbind("click");if(e.signDateData&&e.signDateData.length&&e.signDateData.length==t.length){var r=e.signDateData;var o=new Date;var c=o.getDate();for(var l=0;l<r.length;l++){if(r[l].signState=="2"){if(util.strToArr(r[l].signDate,"-")[2]>=util.strToArr(e.exchangeStartDate,"-")[2]){t.eq(l).addClass("exchange-signed-day");t.eq(l).removeClass("signed-day")}else{t.eq(l).addClass("signed-day");t.eq(l).removeClass("exchange-signed-day")}}else{if(util.strToArr(r[l].signDate,"-")[2]<c){if(t.eq(l).hasClass("exchange-sign-day")){t.eq(l).addClass("exchange-signnot-day")}else{t.eq(l).addClass("signnot-day")}}}}var s=Math.ceil(n.find("li").length/7);n.find("li").each(function(e){if(s>3){if(e<(s-3)*7){$(this).remove()}}})}else{util.alert({conTextError:"返回数据错误！"});$("#signBtn").unbind("click");$("#calender").html("");for(var l=0;l<21;l++){$("#calender").append("<li></li>")}}var d=a.find(".count-details-list");d.removeClass("count-box-empty");d.html("");var g=a.find(".count-box");if(e.state=="no_login"){g.hide();a.hide()}else{g.show();a.show()}if(e.integralDetailData&&e.integralDetailData.length>0){var u=e.integralDetailData;for(var l=0;l<u.length;l++){d.append("<li><div>"+u[l].operateDate+"</div><div>"+(u[l].operateType==1?"签到":"兑换")+"</div><div>"+(u[l].operateType==1?"+":"-")+u[l].operateIntegral+"</div></li>")}if(u.length<4){for(var l=0;l<4-u.length;l++){d.append("<li><div></div><div></div><div></div></li>")}}}else{d.html("您还未获得积分，赶快去签到赚积分吧~");d.addClass("count-box-empty")}a.find(".count-fen-all").html(e.cumulativeIntegral);a.find(".count-fen").html(e.exchangeIntegral)}}})}}$(function(){$(".exchange-head-link").find("a").attr("href","//myhome"+cookieDomain+"/member/gomeMyCoupon");var e=$(".ac-container").parent().parent();var t=e.parent();e.css("cssText","width: auto !important; margin: 0px auto; overflow: hidden;");t.css("cssText","width: auto !important; margin: 0px auto; overflow: hidden;");util.fitPlaceholder();$("#calender").html("");for(var n=0;n<21;n++){$("#calender").append("<li></li>")}getSignIntegralInfo(getSignIntegralInfoUrl,promId,"#calender","#countDetails");$(".signBtnClick").bind("click",function(){if(!util.hasModelFlag){$.ajax({url:doSignUrl,type:"get",dataType:"JSONP",data:{promId:promId},success:function(e){if(e.state=="no_login"){util.login(function(){$(".signBtnClick").trigger("click")})}else if(e.state=="success"){util.confirmClick({elName:"sign_success",title:"签到成功",conTextL:"恭喜您获得 ",conTextR:e.signIntegral+"积分",subcontent:"(10积分可兑换1元优惠券)",callback:function(){getSignIntegralInfo(getSignIntegralInfoUrl,promId,"#calender","#countDetails")}});util.hasModelFlag=true}else if(e.state=="already_signin"){util.confirmClick({elName:"sign_fail",title:"签到失败",conTextError:e.remark||"你没有次数了~",callback:function(){getSignIntegralInfo(getSignIntegralInfoUrl,promId,"#calender","#countDetails")}});util.hasModelFlag=true}else{util.confirmClick({elName:"sign_fail",title:"签到失败",conTextError:e.remark||"过会儿再试试~"});util.hasModelFlag=true}},error:function(){util.confirmClick({elName:"sign_fail",title:"签到失败",conTextError:data.remark||"过会儿再试试~"});util.hasModelFlag=true}})}else{return false}});$(".exchange-input").bind("keyup onafterpaste",function(){var e=$(this).val();if(e==0)e="";var t=$(".exchange-points").find(".points").html();if(parseInt(e)>parseInt(t))e=t;if(parseInt(e)>10)e=e.substring(0,e.length-1)+"0";e=e.replace(/\D/g,"").substring(0,5);$(this).val(e)});$(".exchange-input").bind("focus",function(){$(".change-popBox").hide()});$(".exchange-btns").find(".exBtn").bind("click",function(){var e=$(this);$(".change-popBox").hide();if(loginData.loginStatus&&loginData.loginStatus<3){$.ajax({url:stageJsServer+"/gmlib/unit/g/1.0.0/g.min.js",dataType:"script",cache:true,success:function(){g.login(function(){$(".exchange-input").val("");getSignIntegralInfo(getSignIntegralInfoUrl,promId,"#calender","#countDetails")})}})}else{var t=$(".exchange-input").val();var n=$(".exchange-btns").find(".change-popBox");if(!t.length){n.find(".content1").html("请输入您想要兑换的积分数量");n.find(".content2").html("");n.show()}else{if(parseInt(t)<10){n.find(".content1").html("最少10积分起兑");n.find(".content2").html("继续加油积攒您的积分吧");n.show()}else if(t==$(".exchange-input").attr("placeholder")){n.find(".content1").html("请输入您想要兑换的积分数量");n.find(".content2").html("");n.show()}else{$.ajax({url:doExchangeUrl,type:"get",dataType:"JSONP",data:{promId:promId,exchangeIntegral:t},success:function(t){if(t.state=="no_login"){util.login(function(){e.trigger("click")})}else if(t.state=="success"){util.confirmClick({title:"兑换成功",elName:"sign_success_2",conTextL:"恭喜您获得 ",conTextR:t.couponValue+"元优惠券",subcontent:t.couponDescription,urltext:"立即查看优惠券",urlLink:"//myhome"+cookieDomain+"/member/gomeMyCoupon",callback:function(){$(".exchange-input").val("");util.fitPlaceholder();getSignIntegralInfo(getSignIntegralInfoUrl,promId,"#calender","#countDetails")}})}else{util.confirmClick({title:"兑换失败",elName:"sign_fail",conTextError:t.remark||"请稍后再试~"})}},error:function(){util.confirmClick({title:"兑换失败",elName:"sign_fail",conTextError:data.remark||"请稍后再试~"})}})}}}});$(".change-popBox").find(".popBtn").bind("click",function(){$(".change-popBox").hide()})});var THREE=THREE||{};if(!self.Int32Array)self.Int32Array=Array,self.Float32Array=Array;THREE.Color=function(t){t!==void 0&&this.setHex(t);return this};THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,copy:function(t){this.r=t.r;this.g=t.g;this.b=t.b;return this},copyGammaToLinear:function(t){this.r=t.r*t.r;this.g=t.g*t.g;this.b=t.b*t.b;return this},copyLinearToGamma:function(t){this.r=Math.sqrt(t.r);this.g=Math.sqrt(t.g);this.b=Math.sqrt(t.b);return this},setRGB:function(t,i,e){this.r=t;this.g=i;this.b=e;return this},setHSV:function(t,i,e){var n,o,r;if(e===0)this.r=this.g=this.b=0;else switch(n=Math.floor(t*6),o=t*6-n,t=e*(1-i),r=e*(1-i*o),i=e*(1-i*(1-o)),n){case 1:this.r=r;this.g=e;this.b=t;break;case 2:this.r=t;this.g=e;this.b=i;break;case 3:this.r=t;this.g=r;this.b=e;break;case 4:this.r=i;this.g=t;this.b=e;break;case 5:this.r=e;this.g=t;this.b=r;break;case 6:case 0:this.r=e,this.g=i,this.b=t}return this},setHex:function(t){t=Math.floor(t);this.r=(t>>16&255)/255;this.g=(t>>8&255)/255;this.b=(t&255)/255;return this},getHex:function(){return~~(this.r*255)<<16^~~(this.g*255)<<8^~~(this.b*255)},getContextStyle:function(){return"rgb("+Math.floor(this.r*255)+","+Math.floor(this.g*255)+","+Math.floor(this.b*255)+")"},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}};THREE.Vector2=function(t,i){this.x=t||0;this.y=i||0};THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(t,i){this.x=t;this.y=i;return this},copy:function(t){this.x=t.x;this.y=t.y;return this},clone:function(){return new THREE.Vector2(this.x,this.y)},add:function(t,i){this.x=t.x+i.x;this.y=t.y+i.y;return this},addSelf:function(t){this.x+=t.x;this.y+=t.y;return this},sub:function(t,i){this.x=t.x-i.x;this.y=t.y-i.y;return this},subSelf:function(t){this.x-=t.x;this.y-=t.y;return this},multiplyScalar:function(t){this.x*=t;this.y*=t;return this},divideScalar:function(t){t?(this.x/=t,this.y/=t):this.set(0,0);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var i=this.x-t.x,t=this.y-t.y;return i*i+t*t},setLength:function(t){return this.normalize().multiplyScalar(t)},equals:function(t){return t.x===this.x&&t.y===this.y}};THREE.Vector3=function(t,i,e){this.x=t||0;this.y=i||0;this.z=e||0};THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(t,i,e){this.x=t;this.y=i;this.z=e;return this},setX:function(t){this.x=t;return this},setY:function(t){this.y=t;return this},setZ:function(t){this.z=t;return this},copy:function(t){this.x=t.x;this.y=t.y;this.z=t.z;return this},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)},add:function(t,i){this.x=t.x+i.x;this.y=t.y+i.y;this.z=t.z+i.z;return this},addSelf:function(t){this.x+=t.x;this.y+=t.y;this.z+=t.z;return this},addScalar:function(t){this.x+=t;this.y+=t;this.z+=t;return this},sub:function(t,i){this.x=t.x-i.x;this.y=t.y-i.y;this.z=t.z-i.z;return this},subSelf:function(t){this.x-=t.x;this.y-=t.y;this.z-=t.z;return this},multiply:function(t,i){this.x=t.x*i.x;this.y=t.y*i.y;this.z=t.z*i.z;return this},multiplySelf:function(t){this.x*=t.x;this.y*=t.y;this.z*=t.z;return this},multiplyScalar:function(t){this.x*=t;this.y*=t;this.z*=t;return this},divideSelf:function(t){this.x/=t.x;this.y/=t.y;this.z/=t.z;return this},divideScalar:function(t){t?(this.x/=t,this.y/=t,this.z/=t):this.z=this.y=this.x=0;return this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){return this.normalize().multiplyScalar(t)},cross:function(t,i){this.x=t.y*i.z-t.z*i.y;this.y=t.z*i.x-t.x*i.z;this.z=t.x*i.y-t.y*i.x;return this},crossSelf:function(t){var i=this.x,e=this.y,n=this.z;this.x=e*t.z-n*t.y;this.y=n*t.x-i*t.z;this.z=i*t.y-e*t.x;return this},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){return(new THREE.Vector3).sub(this,t).lengthSq()},setPositionFromMatrix:function(t){this.x=t.n14;this.y=t.n24;this.z=t.n34},setRotationFromMatrix:function(t){var i=Math.cos(this.y);this.y=Math.asin(t.n13);Math.abs(i)>1e-5?(this.x=Math.atan2(-t.n23/i,t.n33/i),this.z=Math.atan2(-t.n12/i,t.n11/i)):(this.x=0,this.z=Math.atan2(t.n21,t.n22))},isZero:function(){return this.lengthSq()<1e-4}};THREE.Vector4=function(t,i,e,n){this.x=t||0;this.y=i||0;this.z=e||0;this.w=n!==void 0?n:1};THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(t,i,e,n){this.x=t;this.y=i;this.z=e;this.w=n;return this},copy:function(t){this.x=t.x;this.y=t.y;this.z=t.z;this.w=t.w!==void 0?t.w:1},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)},add:function(t,i){this.x=t.x+i.x;this.y=t.y+i.y;this.z=t.z+i.z;this.w=t.w+i.w;return this},addSelf:function(t){this.x+=t.x;this.y+=t.y;this.z+=t.z;this.w+=t.w;return this},sub:function(t,i){this.x=t.x-i.x;this.y=t.y-i.y;this.z=t.z-i.z;this.w=t.w-i.w;return this},subSelf:function(t){this.x-=t.x;this.y-=t.y;this.z-=t.z;this.w-=t.w;return this},multiplyScalar:function(t){this.x*=t;this.y*=t;this.z*=t;this.w*=t;return this},divideScalar:function(t){t?(this.x/=t,this.y/=t,this.z/=t,this.w/=t):(this.z=this.y=this.x=0,this.w=1);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){return this.normalize().multiplyScalar(t)},lerpSelf:function(t,i){this.x+=(t.x-this.x)*i;this.y+=(t.y-this.y)*i;this.z+=(t.z-this.z)*i;this.w+=(t.w-this.w)*i;return this}};THREE.Ray=function(t,i){function e(t,i,e){E.sub(e,t);d=E.dot(i);if(d<=0)return null;u=p.add(t,f.copy(i).multiplyScalar(d));return m=e.distanceTo(u)}function n(t,i,e,n){E.sub(n,i);p.sub(e,i);f.sub(t,i);g=E.dot(E);T=E.dot(p);R=E.dot(f);y=p.dot(p);x=p.dot(f);v=1/(g*y-T*T);H=(y*R-T*x)*v;w=(g*x-T*R)*v;return H>=0&&w>=0&&H+w<1}this.origin=t||new THREE.Vector3;this.direction=i||new THREE.Vector3;this.intersectScene=function(t){return this.intersectObjects(t.children)};this.intersectObjects=function(t){var i,e,n=[];i=0;for(e=t.length;i<e;i++)Array.prototype.push.apply(n,this.intersectObject(t[i]));n.sort(function(t,i){return t.distance-i.distance});return n};var o=new THREE.Vector3,r=new THREE.Vector3,s=new THREE.Vector3,a=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3,h=new THREE.Vector3,c=new THREE.Vector3,l=new THREE.Vector3;this.intersectObject=function(E){for(var p,f=[],d=0,u=E.children.length;d<u;d++)Array.prototype.push.apply(f,this.intersectObject(E.children[d]));if(E instanceof THREE.Particle){d=e(this.origin,this.direction,E.matrixWorld.getPosition());if(d===null||d>E.scale.x)return[];p={distance:d,point:E.position,face:null,object:E};f.push(p)}else if(E instanceof THREE.Mesh){d=e(this.origin,this.direction,E.matrixWorld.getPosition());if(d===null||d>E.geometry.boundingSphere.radius*Math.max(E.scale.x,Math.max(E.scale.y,E.scale.z)))return f;var m,g=E.geometry,T=g.vertices,R;E.matrixRotationWorld.extractRotation(E.matrixWorld);d=0;for(u=g.faces.length;d<u;d++)if(p=g.faces[d],t.copy(this.origin),i.copy(this.direction),R=E.matrixWorld,h=R.multiplyVector3(h.copy(p.centroid)).subSelf(t),m=h.dot(i),!(m<=0)&&(o=R.multiplyVector3(o.copy(T[p.a].position)),r=R.multiplyVector3(r.copy(T[p.b].position)),s=R.multiplyVector3(s.copy(T[p.c].position)),p instanceof THREE.Face4&&(a=R.multiplyVector3(a.copy(T[p.d].position))),c=E.matrixRotationWorld.multiplyVector3(c.copy(p.normal)),m=i.dot(c),E.doubleSided||(E.flipSided?m>0:m<0)))if(m=c.dot(h.sub(o,t))/m,l.add(t,i.multiplyScalar(m)),p instanceof THREE.Face3)n(l,o,r,s)&&(p={distance:t.distanceTo(l),point:l.clone(),face:p,object:E},f.push(p));else if(p instanceof THREE.Face4&&(n(l,o,r,a)||n(l,r,s,a)))p={distance:t.distanceTo(l),point:l.clone(),face:p,object:E},f.push(p)}return f};var E=new THREE.Vector3,p=new THREE.Vector3,f=new THREE.Vector3,d,u,m,g,T,R,y,x,v,H,w};THREE.Rectangle=function(){function t(){r=n-i;s=o-e}var i,e,n,o,r,s,a=!0;this.getX=function(){return i};this.getY=function(){return e};this.getWidth=function(){return r};this.getHeight=function(){return s};this.getLeft=function(){return i};this.getTop=function(){return e};this.getRight=function(){return n};this.getBottom=function(){return o};this.set=function(r,s,h,c){a=!1;i=r;e=s;n=h;o=c;t()};this.addPoint=function(r,s){a?(a=!1,i=r,e=s,n=r,o=s):(i=i<r?i:r,e=e<s?e:s,n=n>r?n:r,o=o>s?o:s);t()};this.add3Points=function(r,s,h,c,l,E){a?(a=!1,i=r<h?r<l?r:l:h<l?h:l,e=s<c?s<E?s:E:c<E?c:E,n=r>h?r>l?r:l:h>l?h:l,o=s>c?s>E?s:E:c>E?c:E):(i=r<h?r<l?r<i?r:i:l<i?l:i:h<l?h<i?h:i:l<i?l:i,e=s<c?s<E?s<e?s:e:E<e?E:e:c<E?c<e?c:e:E<e?E:e,n=r>h?r>l?r>n?r:n:l>n?l:n:h>l?h>n?h:n:l>n?l:n,o=s>c?s>E?s>o?s:o:E>o?E:o:c>E?c>o?c:o:E>o?E:o);t()};this.addRectangle=function(r){a?(a=!1,i=r.getLeft(),e=r.getTop(),n=r.getRight(),o=r.getBottom()):(i=i<r.getLeft()?i:r.getLeft(),e=e<r.getTop()?e:r.getTop(),n=n>r.getRight()?n:r.getRight(),o=o>r.getBottom()?o:r.getBottom());t()};this.inflate=function(r){i-=r;e-=r;n+=r;o+=r;t()};this.minSelf=function(r){i=i>r.getLeft()?i:r.getLeft();e=e>r.getTop()?e:r.getTop();n=n<r.getRight()?n:r.getRight();o=o<r.getBottom()?o:r.getBottom();t()};this.intersects=function(t){return Math.min(n,t.getRight())-Math.max(i,t.getLeft())>=0&&Math.min(o,t.getBottom())-Math.max(e,t.getTop())>=0};this.empty=function(){a=!0;o=n=e=i=0;t()};this.isEmpty=function(){return a}};THREE.Math={clamp:function(t,i,e){return t<i?i:t>e?e:t},clampBottom:function(t,i){return t<i?i:t},mapLinear:function(t,i,e,n,o){return n+(t-i)*(o-n)/(e-i)},random16:function(){return(65280*Math.random()+255*Math.random())/65535}};THREE.Matrix3=function(){this.m=[]};THREE.Matrix3.prototype={constructor:THREE.Matrix3,transpose:function(){var t,i=this.m;t=i[1];i[1]=i[3];i[3]=t;t=i[2];i[2]=i[6];i[6]=t;t=i[5];i[5]=i[7];i[7]=t;return this},transposeIntoArray:function(t){var i=this.m;t[0]=i[0];t[1]=i[3];t[2]=i[6];t[3]=i[1];t[4]=i[4];t[5]=i[7];t[6]=i[2];t[7]=i[5];t[8]=i[8];return this}};THREE.Matrix4=function(t,i,e,n,o,r,s,a,h,c,l,E,p,f,d,u){this.set(t!==void 0?t:1,i||0,e||0,n||0,o||0,r!==void 0?r:1,s||0,a||0,h||0,c||0,l!==void 0?l:1,E||0,p||0,f||0,d||0,u!==void 0?u:1);this.flat=Array(16);this.m33=new THREE.Matrix3};THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(t,i,e,n,o,r,s,a,h,c,l,E,p,f,d,u){this.n11=t;this.n12=i;this.n13=e;this.n14=n;this.n21=o;this.n22=r;this.n23=s;this.n24=a;this.n31=h;this.n32=c;this.n33=l;this.n34=E;this.n41=p;this.n42=f;this.n43=d;this.n44=u;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(t){this.set(t.n11,t.n12,t.n13,t.n14,t.n21,t.n22,t.n23,t.n24,t.n31,t.n32,t.n33,t.n34,t.n41,t.n42,t.n43,t.n44);return this},lookAt:function(t,i,e){var n=THREE.Matrix4.__v1,o=THREE.Matrix4.__v2,r=THREE.Matrix4.__v3;r.sub(t,i).normalize();if(r.length()===0)r.z=1;n.cross(e,r).normalize();n.length()===0&&(r.x+=1e-4,n.cross(e,r).normalize());o.cross(r,n).normalize();this.n11=n.x;this.n12=o.x;this.n13=r.x;this.n21=n.y;this.n22=o.y;this.n23=r.y;this.n31=n.z;this.n32=o.z;this.n33=r.z;return this},multiply:function(t,i){var e=t.n11,n=t.n12,o=t.n13,r=t.n14,s=t.n21,a=t.n22,h=t.n23,c=t.n24,l=t.n31,E=t.n32,p=t.n33,f=t.n34,d=t.n41,u=t.n42,m=t.n43,g=t.n44,T=i.n11,R=i.n12,y=i.n13,x=i.n14,v=i.n21,H=i.n22,w=i.n23,M=i.n24,b=i.n31,S=i.n32,z=i.n33,V=i.n34,C=i.n41,B=i.n42,L=i.n43,D=i.n44;this.n11=e*T+n*v+o*b+r*C;this.n12=e*R+n*H+o*S+r*B;this.n13=e*y+n*w+o*z+r*L;this.n14=e*x+n*M+o*V+r*D;this.n21=s*T+a*v+h*b+c*C;this.n22=s*R+a*H+h*S+c*B;this.n23=s*y+a*w+h*z+c*L;this.n24=s*x+a*M+h*V+c*D;this.n31=l*T+E*v+p*b+f*C;this.n32=l*R+E*H+p*S+f*B;this.n33=l*y+E*w+p*z+f*L;this.n34=l*x+E*M+p*V+f*D;this.n41=d*T+u*v+m*b+g*C;this.n42=d*R+u*H+m*S+g*B;this.n43=d*y+u*w+m*z+g*L;this.n44=d*x+u*M+m*V+g*D;return this},multiplySelf:function(t){return this.multiply(this,t)},multiplyToArray:function(t,i,e){this.multiply(t,i);e[0]=this.n11;e[1]=this.n21;e[2]=this.n31;e[3]=this.n41;e[4]=this.n12;e[5]=this.n22;e[6]=this.n32;e[7]=this.n42;e[8]=this.n13;e[9]=this.n23;e[10]=this.n33;e[11]=this.n43;e[12]=this.n14;e[13]=this.n24;e[14]=this.n34;e[15]=this.n44;return this},multiplyScalar:function(t){this.n11*=t;this.n12*=t;this.n13*=t;this.n14*=t;this.n21*=t;this.n22*=t;this.n23*=t;this.n24*=t;this.n31*=t;this.n32*=t;this.n33*=t;this.n34*=t;this.n41*=t;this.n42*=t;this.n43*=t;this.n44*=t;return this},multiplyVector3:function(t){var i=t.x,e=t.y,n=t.z,o=1/(this.n41*i+this.n42*e+this.n43*n+this.n44);t.x=(this.n11*i+this.n12*e+this.n13*n+this.n14)*o;t.y=(this.n21*i+this.n22*e+this.n23*n+this.n24)*o;t.z=(this.n31*i+this.n32*e+this.n33*n+this.n34)*o;return t},multiplyVector4:function(t){var i=t.x,e=t.y,n=t.z,o=t.w;t.x=this.n11*i+this.n12*e+this.n13*n+this.n14*o;t.y=this.n21*i+this.n22*e+this.n23*n+this.n24*o;t.z=this.n31*i+this.n32*e+this.n33*n+this.n34*o;t.w=this.n41*i+this.n42*e+this.n43*n+this.n44*o;return t},rotateAxis:function(t){var i=t.x,e=t.y,n=t.z;t.x=i*this.n11+e*this.n12+n*this.n13;t.y=i*this.n21+e*this.n22+n*this.n23;t.z=i*this.n31+e*this.n32+n*this.n33;t.normalize();return t},crossVector:function(t){var i=new THREE.Vector4;i.x=this.n11*t.x+this.n12*t.y+this.n13*t.z+this.n14*t.w;i.y=this.n21*t.x+this.n22*t.y+this.n23*t.z+this.n24*t.w;i.z=this.n31*t.x+this.n32*t.y+this.n33*t.z+this.n34*t.w;i.w=t.w?this.n41*t.x+this.n42*t.y+this.n43*t.z+this.n44*t.w:1;return i},determinant:function(){var t=this.n11,i=this.n12,e=this.n13,n=this.n14,o=this.n21,r=this.n22,s=this.n23,a=this.n24,h=this.n31,c=this.n32,l=this.n33,E=this.n34,p=this.n41,f=this.n42,d=this.n43,u=this.n44;return n*s*c*p-e*a*c*p-n*r*l*p+i*a*l*p+e*r*E*p-i*s*E*p-n*s*h*f+e*a*h*f+n*o*l*f-t*a*l*f-e*o*E*f+t*s*E*f+n*r*h*d-i*a*h*d-n*o*c*d+t*a*c*d+i*o*E*d-t*r*E*d-e*r*h*u+i*s*h*u+e*o*c*u-t*s*c*u-i*o*l*u+t*r*l*u},transpose:function(){var t;t=this.n21;this.n21=this.n12;this.n12=t;t=this.n31;this.n31=this.n13;this.n13=t;t=this.n32;this.n32=this.n23;this.n23=t;t=this.n41;this.n41=this.n14;this.n14=t;t=this.n42;this.n42=this.n24;this.n24=t;t=this.n43;this.n43=this.n34;this.n43=t;return this},clone:function(){var t=new THREE.Matrix4;t.n11=this.n11;t.n12=this.n12;t.n13=this.n13;t.n14=this.n14;t.n21=this.n21;t.n22=this.n22;t.n23=this.n23;t.n24=this.n24;t.n31=this.n31;t.n32=this.n32;t.n33=this.n33;t.n34=this.n34;t.n41=this.n41;t.n42=this.n42;t.n43=this.n43;t.n44=this.n44;return t},flatten:function(){this.flat[0]=this.n11;this.flat[1]=this.n21;this.flat[2]=this.n31;this.flat[3]=this.n41;this.flat[4]=this.n12;this.flat[5]=this.n22;this.flat[6]=this.n32;this.flat[7]=this.n42;this.flat[8]=this.n13;this.flat[9]=this.n23;this.flat[10]=this.n33;this.flat[11]=this.n43;this.flat[12]=this.n14;this.flat[13]=this.n24;this.flat[14]=this.n34;this.flat[15]=this.n44;return this.flat},flattenToArray:function(t){t[0]=this.n11;t[1]=this.n21;t[2]=this.n31;t[3]=this.n41;t[4]=this.n12;t[5]=this.n22;t[6]=this.n32;t[7]=this.n42;t[8]=this.n13;t[9]=this.n23;t[10]=this.n33;t[11]=this.n43;t[12]=this.n14;t[13]=this.n24;t[14]=this.n34;t[15]=this.n44;return t},flattenToArrayOffset:function(t,i){t[i]=this.n11;t[i+1]=this.n21;t[i+2]=this.n31;t[i+3]=this.n41;t[i+4]=this.n12;t[i+5]=this.n22;t[i+6]=this.n32;t[i+7]=this.n42;t[i+8]=this.n13;t[i+9]=this.n23;t[i+10]=this.n33;t[i+11]=this.n43;t[i+12]=this.n14;t[i+13]=this.n24;t[i+14]=this.n34;t[i+15]=this.n44;return t},setTranslation:function(t,i,e){this.set(1,0,0,t,0,1,0,i,0,0,1,e,0,0,0,1);return this},setScale:function(t,i,e){this.set(t,0,0,0,0,i,0,0,0,0,e,0,0,0,0,1);return this},setRotationX:function(t){var i=Math.cos(t),t=Math.sin(t);this.set(1,0,0,0,0,i,-t,0,0,t,i,0,0,0,0,1);return this},setRotationY:function(t){var i=Math.cos(t),t=Math.sin(t);this.set(i,0,t,0,0,1,0,0,-t,0,i,0,0,0,0,1);return this},setRotationZ:function(t){var i=Math.cos(t),t=Math.sin(t);this.set(i,-t,0,0,t,i,0,0,0,0,1,0,0,0,0,1);return this},setRotationAxis:function(t,i){var e=Math.cos(i),n=Math.sin(i),o=1-e,r=t.x,s=t.y,a=t.z,h=o*r,c=o*s;this.set(h*r+e,h*s-n*a,h*a+n*s,0,h*s+n*a,c*s+e,c*a-n*r,0,h*a-n*s,c*a+n*r,o*a*a+e,0,0,0,0,1);return this},setPosition:function(t){this.n14=t.x;this.n24=t.y;this.n34=t.z;return this},getPosition:function(){return THREE.Matrix4.__v1.set(this.n14,this.n24,this.n34)},getColumnX:function(){return THREE.Matrix4.__v1.set(this.n11,this.n21,this.n31)},getColumnY:function(){return THREE.Matrix4.__v1.set(this.n12,this.n22,this.n32)},getColumnZ:function(){return THREE.Matrix4.__v1.set(this.n13,this.n23,this.n33)},getInverse:function(t){var i=t.n11,e=t.n12,n=t.n13,o=t.n14,r=t.n21,s=t.n22,a=t.n23,h=t.n24,c=t.n31,l=t.n32,E=t.n33,p=t.n34,f=t.n41,d=t.n42,u=t.n43,m=t.n44;this.n11=a*p*d-h*E*d+h*l*u-s*p*u-a*l*m+s*E*m;this.n12=o*E*d-n*p*d-o*l*u+e*p*u+n*l*m-e*E*m;this.n13=n*h*d-o*a*d+o*s*u-e*h*u-n*s*m+e*a*m;this.n14=o*a*l-n*h*l-o*s*E+e*h*E+n*s*p-e*a*p;this.n21=h*E*f-a*p*f-h*c*u+r*p*u+a*c*m-r*E*m;this.n22=n*p*f-o*E*f+o*c*u-i*p*u-n*c*m+i*E*m;this.n23=o*a*f-n*h*f-o*r*u+i*h*u+n*r*m-i*a*m;this.n24=n*h*c-o*a*c+o*r*E-i*h*E-n*r*p+i*a*p;this.n31=s*p*f-h*l*f+h*c*d-r*p*d-s*c*m+r*l*m;this.n32=o*l*f-e*p*f-o*c*d+i*p*d+e*c*m-i*l*m;this.n33=n*h*f-o*s*f+o*r*d-i*h*d-e*r*m+i*s*m;this.n34=o*s*c-e*h*c-o*r*l+i*h*l+e*r*p-i*s*p;this.n41=a*l*f-s*E*f-a*c*d+r*E*d+s*c*u-r*l*u;this.n42=e*E*f-n*l*f+n*c*d-i*E*d-e*c*u+i*l*u;this.n43=n*s*f-e*a*f-n*r*d+i*a*d+e*r*u-i*s*u;this.n44=e*a*c-n*s*c+n*r*l-i*a*l-e*r*E+i*s*E;this.multiplyScalar(1/t.determinant());return this},setRotationFromEuler:function(t,i){var e=t.x,n=t.y,o=t.z,r=Math.cos(e),e=Math.sin(e),s=Math.cos(n),n=Math.sin(n),a=Math.cos(o),o=Math.sin(o);switch(i){case"YXZ":var h=s*a,c=s*o,l=n*a,E=n*o;this.n11=h+E*e;this.n12=l*e-c;this.n13=r*n;this.n21=r*o;this.n22=r*a;this.n23=-e;this.n31=c*e-l;this.n32=E+h*e;this.n33=r*s;break;case"ZXY":h=s*a;c=s*o;l=n*a;E=n*o;this.n11=h-E*e;this.n12=-r*o;this.n13=l+c*e;this.n21=c+l*e;this.n22=r*a;this.n23=E-h*e;this.n31=-r*n;this.n32=e;this.n33=r*s;break;case"ZYX":h=r*a;c=r*o;l=e*a;E=e*o;this.n11=s*a;this.n12=l*n-c;this.n13=h*n+E;this.n21=s*o;this.n22=E*n+h;this.n23=c*n-l;this.n31=-n;this.n32=e*s;this.n33=r*s;break;case"YZX":h=r*s;c=r*n;l=e*s;E=e*n;this.n11=s*a;this.n12=E-h*o;this.n13=l*o+c;this.n21=o;this.n22=r*a;this.n23=-e*a;this.n31=-n*a;this.n32=c*o+l;this.n33=h-E*o;break;case"XZY":h=r*s;c=r*n;l=e*s;E=e*n;this.n11=s*a;this.n12=-o;this.n13=n*a;this.n21=h*o+E;this.n22=r*a;this.n23=c*o-l;this.n31=l*o-c;this.n32=e*a;this.n33=E*o+h;break;default:h=r*a,c=r*o,l=e*a,E=e*o,this.n11=s*a,this.n12=-s*o,this.n13=n,this.n21=c+l*n,this.n22=h-E*n,this.n23=-e*s,this.n31=E-h*n,this.n32=l+c*n,this.n33=r*s}return this},setRotationFromQuaternion:function(t){var i=t.x,e=t.y,n=t.z,o=t.w,r=i+i,s=e+e,a=n+n,t=i*r,h=i*s;i*=a;var c=e*s;e*=a;n*=a;r*=o;s*=o;o*=a;this.n11=1-(c+n);this.n12=h-o;this.n13=i+s;this.n21=h+o;this.n22=1-(t+n);this.n23=e-r;this.n31=i-s;this.n32=e+r;this.n33=1-(t+c);return this},scale:function(t){var i=t.x,e=t.y,t=t.z;this.n11*=i;this.n12*=e;this.n13*=t;this.n21*=i;this.n22*=e;this.n23*=t;this.n31*=i;this.n32*=e;this.n33*=t;this.n41*=i;this.n42*=e;this.n43*=t;return this},compose:function(t,i,e){var n=THREE.Matrix4.__m1,o=THREE.Matrix4.__m2;n.identity();n.setRotationFromQuaternion(i);o.setScale(e.x,e.y,e.z);this.multiply(n,o);this.n14=t.x;this.n24=t.y;this.n34=t.z;return this},decompose:function(t,i,e){var n=THREE.Matrix4.__v1,o=THREE.Matrix4.__v2,r=THREE.Matrix4.__v3;n.set(this.n11,this.n21,this.n31);o.set(this.n12,this.n22,this.n32);r.set(this.n13,this.n23,this.n33);t=t instanceof THREE.Vector3?t:new THREE.Vector3;i=i instanceof THREE.Quaternion?i:new THREE.Quaternion;e=e instanceof THREE.Vector3?e:new THREE.Vector3;e.x=n.length();e.y=o.length();e.z=r.length();t.x=this.n14;t.y=this.n24;t.z=this.n34;n=THREE.Matrix4.__m1;n.copy(this);n.n11/=e.x;n.n21/=e.x;n.n31/=e.x;n.n12/=e.y;n.n22/=e.y;n.n32/=e.y;n.n13/=e.z;n.n23/=e.z;n.n33/=e.z;i.setFromRotationMatrix(n);return[t,i,e]},extractPosition:function(t){this.n14=t.n14;this.n24=t.n24;this.n34=t.n34;return this},extractRotation:function(t){var i=THREE.Matrix4.__v1,e=1/i.set(t.n11,t.n21,t.n31).length(),n=1/i.set(t.n12,t.n22,t.n32).length(),i=1/i.set(t.n13,t.n23,t.n33).length();this.n11=t.n11*e;this.n21=t.n21*e;this.n31=t.n31*e;this.n12=t.n12*n;this.n22=t.n22*n;this.n32=t.n32*n;this.n13=t.n13*i;this.n23=t.n23*i;this.n33=t.n33*i;return this}};THREE.Matrix4.makeInvert3x3=function(t){var i=t.m33,e=i.m,n=t.n33*t.n22-t.n32*t.n23,o=-t.n33*t.n21+t.n31*t.n23,r=t.n32*t.n21-t.n31*t.n22,s=-t.n33*t.n12+t.n32*t.n13,a=t.n33*t.n11-t.n31*t.n13,h=-t.n32*t.n11+t.n31*t.n12,c=t.n23*t.n12-t.n22*t.n13,l=-t.n23*t.n11+t.n21*t.n13,E=t.n22*t.n11-t.n21*t.n12,t=t.n11*n+t.n21*s+t.n31*c;t===0&&console.error("THREE.Matrix4.makeInvert3x3: Matrix not invertible.");t=1/t;e[0]=t*n;e[1]=t*o;e[2]=t*r;e[3]=t*s;e[4]=t*a;e[5]=t*h;e[6]=t*c;e[7]=t*l;e[8]=t*E;return i};THREE.Matrix4.makeFrustum=function(t,i,e,n,o,r){var s;s=new THREE.Matrix4;s.n11=2*o/(i-t);s.n12=0;s.n13=(i+t)/(i-t);s.n14=0;s.n21=0;s.n22=2*o/(n-e);s.n23=(n+e)/(n-e);s.n24=0;s.n31=0;s.n32=0;s.n33=-(r+o)/(r-o);s.n34=-2*r*o/(r-o);s.n41=0;s.n42=0;s.n43=-1;s.n44=0;return s};THREE.Matrix4.makePerspective=function(t,i,e,n){var o,t=e*Math.tan(t*Math.PI/360);o=-t;return THREE.Matrix4.makeFrustum(o*i,t*i,o,t,e,n)};THREE.Matrix4.makeOrtho=function(t,i,e,n,o,r){var s,a,h,c;s=new THREE.Matrix4;a=i-t;h=e-n;c=r-o;s.n11=2/a;s.n12=0;s.n13=0;s.n14=-((i+t)/a);s.n21=0;s.n22=2/h;s.n23=0;s.n24=-((e+n)/h);s.n31=0;s.n32=0;s.n33=-2/c;s.n34=-((r+o)/c);s.n41=0;s.n42=0;s.n43=0;s.n44=1;return s};THREE.Matrix4.__v1=new THREE.Vector3;THREE.Matrix4.__v2=new THREE.Vector3;THREE.Matrix4.__v3=new THREE.Vector3;THREE.Matrix4.__m1=new THREE.Matrix4;THREE.Matrix4.__m2=new THREE.Matrix4;THREE.Object3D=function(){this.name="";this.id=THREE.Object3DCount++;this.parent=void 0;this.children=[];this.up=new THREE.Vector3(0,1,0);this.position=new THREE.Vector3;this.rotation=new THREE.Vector3;this.eulerOrder="XYZ";this.scale=new THREE.Vector3(1,1,1);this.flipSided=this.doubleSided=this.dynamic=!1;this.renderDepth=null;this.rotationAutoUpdate=!0;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixRotationWorld=new THREE.Matrix4;this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0;this.quaternion=new THREE.Quaternion;this.useQuaternion=!1;this.boundRadius=0;this.boundRadiusScale=1;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this._vector=new THREE.Vector3};THREE.Object3D.prototype={constructor:THREE.Object3D,translate:function(t,i){this.matrix.rotateAxis(i);this.position.addSelf(i.multiplyScalar(t))},translateX:function(t){this.translate(t,this._vector.set(1,0,0))},translateY:function(t){this.translate(t,this._vector.set(0,1,0))},translateZ:function(t){this.translate(t,this._vector.set(0,0,1))},lookAt:function(t){this.matrix.lookAt(t,this.position,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},add:function(t){if(this.children.indexOf(t)===-1){t.parent!==void 0&&t.parent.remove(t);t.parent=this;this.children.push(t);for(var i=this;i.parent!==void 0;)i=i.parent;i!==void 0&&i instanceof THREE.Scene&&i.addObject(t)}},remove:function(t){var i=this.children.indexOf(t);if(i!==-1){t.parent=void 0;this.children.splice(i,1);for(i=this;i.parent!==void 0;)i=i.parent;i!==void 0&&i instanceof THREE.Scene&&i.removeObject(t)}},getChildByName:function(t,i){var e,n,o;e=0;for(n=this.children.length;e<n;e++){o=this.children[e];if(o.name===t)return o;if(i&&(o=o.getChildByName(t,i),o!==void 0))return o}},updateMatrix:function(){this.matrix.setPosition(this.position);this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1)this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z));this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||t)this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0;for(var i=0,e=this.children.length;i<e;i++)this.children[i].updateMatrixWorld(t)}};THREE.Object3DCount=0;THREE.Projector=function(){function t(){var t=s[r]=s[r]||new THREE.RenderableObject;r++;return t}function i(){var t=c[h]=c[h]||new THREE.RenderableVertex;h++;return t}function e(t,i){return i.z-t.z}function n(t,i){var e=0,n=1,o=t.z+t.w,r=i.z+i.w,s=-t.z+t.w,a=-i.z+i.w;return o>=0&&r>=0&&s>=0&&a>=0?!0:o<0&&r<0||s<0&&a<0?!1:(o<0?e=Math.max(e,o/(o-r)):r<0&&(n=Math.min(n,o/(o-r))),s<0?e=Math.max(e,s/(s-a)):a<0&&(n=Math.min(n,s/(s-a))),n<e?!1:(t.lerpSelf(i,e),i.lerpSelf(t,1-n),!0))}var o,r,s=[],a,h,c=[],l,E,p=[],f,d=[],u,m,g=[],T,R,y=[],x={objects:[],sprites:[],lights:[],elements:[]},v=new THREE.Vector3,H=new THREE.Vector4,w=new THREE.Matrix4,M=new THREE.Matrix4,b=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],S=new THREE.Vector4,z=new THREE.Vector4;this.computeFrustum=function(t){b[0].set(t.n41-t.n11,t.n42-t.n12,t.n43-t.n13,t.n44-t.n14);b[1].set(t.n41+t.n11,t.n42+t.n12,t.n43+t.n13,t.n44+t.n14);b[2].set(t.n41+t.n21,t.n42+t.n22,t.n43+t.n23,t.n44+t.n24);b[3].set(t.n41-t.n21,t.n42-t.n22,t.n43-t.n23,t.n44-t.n24);b[4].set(t.n41-t.n31,t.n42-t.n32,t.n43-t.n33,t.n44-t.n34);b[5].set(t.n41+t.n31,t.n42+t.n32,t.n43+t.n33,t.n44+t.n34);for(t=0;t<6;t++){var i=b[t];i.divideScalar(Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z))}};this.projectVector=function(t,i){i.matrixWorldInverse.getInverse(i.matrixWorld);w.multiply(i.projectionMatrix,i.matrixWorldInverse);w.multiplyVector3(t);return t};this.unprojectVector=function(t,i){i.projectionMatrixInverse.getInverse(i.projectionMatrix);w.multiply(i.matrixWorld,i.projectionMatrixInverse);w.multiplyVector3(t);return t};this.pickingRay=function(t,i){var e;t.z=-1;e=new THREE.Vector3(t.x,t.y,1);this.unprojectVector(t,i);this.unprojectVector(e,i);e.subSelf(t).normalize();return new THREE.Ray(t,e)};this.projectGraph=function(i,n){r=0;x.objects.length=0;x.sprites.length=0;x.lights.length=0;var s=function(i){if(i.visible!==!1){var e;if(e=i instanceof THREE.Mesh||i instanceof THREE.Line)if(!(e=i.frustumCulled===!1))t:{for(var n=i.matrixWorld,r=-i.geometry.boundingSphere.radius*Math.max(i.scale.x,Math.max(i.scale.y,i.scale.z)),a=0;a<6;a++)if(e=b[a].x*n.n14+b[a].y*n.n24+b[a].z*n.n34+b[a].w,e<=r){e=!1;break t}e=!0}e?(w.multiplyVector3(v.copy(i.position)),o=t(),o.object=i,o.z=v.z,x.objects.push(o)):i instanceof THREE.Sprite||i instanceof THREE.Particle?(w.multiplyVector3(v.copy(i.position)),o=t(),o.object=i,o.z=v.z,x.sprites.push(o)):i instanceof THREE.Light&&x.lights.push(i);e=0;for(n=i.children.length;e<n;e++)s(i.children[e])}};s(i);n&&x.objects.sort(e);return x};this.projectScene=function(t,o,r){var s=o.near,v=o.far,b,V,C,B,L,D,j,W,P,A,N,O,_,F,I,Y;R=m=f=E=0;x.elements.length=0;o.parent===void 0&&(console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),t.add(o));t.updateMatrixWorld();o.matrixWorldInverse.getInverse(o.matrixWorld);w.multiply(o.projectionMatrix,o.matrixWorldInverse);this.computeFrustum(w);x=this.projectGraph(t,!1);t=0;for(b=x.objects.length;t<b;t++)if(P=x.objects[t].object,A=P.matrixWorld,O=P.material,h=0,P instanceof THREE.Mesh){N=P.geometry;_=P.geometry.materials;B=N.vertices;F=N.faces;I=N.faceVertexUvs;N=P.matrixRotationWorld.extractRotation(A);V=0;for(C=B.length;V<C;V++)a=i(),a.positionWorld.copy(B[V].position),A.multiplyVector3(a.positionWorld),a.positionScreen.copy(a.positionWorld),w.multiplyVector4(a.positionScreen),a.positionScreen.x/=a.positionScreen.w,a.positionScreen.y/=a.positionScreen.w,a.visible=a.positionScreen.z>s&&a.positionScreen.z<v;B=0;for(V=F.length;B<V;B++){C=F[B];if(C instanceof THREE.Face3)if(L=c[C.a],D=c[C.b],j=c[C.c],L.visible&&D.visible&&j.visible&&(P.doubleSided||P.flipSided!=(j.positionScreen.x-L.positionScreen.x)*(D.positionScreen.y-L.positionScreen.y)-(j.positionScreen.y-L.positionScreen.y)*(D.positionScreen.x-L.positionScreen.x)<0))W=p[E]=p[E]||new THREE.RenderableFace3,E++,l=W,l.v1.copy(L),l.v2.copy(D),l.v3.copy(j);else continue;else if(C instanceof THREE.Face4)if(L=c[C.a],D=c[C.b],j=c[C.c],W=c[C.d],L.visible&&D.visible&&j.visible&&W.visible&&(P.doubleSided||P.flipSided!=((W.positionScreen.x-L.positionScreen.x)*(D.positionScreen.y-L.positionScreen.y)-(W.positionScreen.y-L.positionScreen.y)*(D.positionScreen.x-L.positionScreen.x)<0||(D.positionScreen.x-j.positionScreen.x)*(W.positionScreen.y-j.positionScreen.y)-(D.positionScreen.y-j.positionScreen.y)*(W.positionScreen.x-j.positionScreen.x)<0)))Y=d[f]=d[f]||new THREE.RenderableFace4,f++,l=Y,l.v1.copy(L),l.v2.copy(D),l.v3.copy(j),l.v4.copy(W);else continue;l.normalWorld.copy(C.normal);N.multiplyVector3(l.normalWorld);l.centroidWorld.copy(C.centroid);A.multiplyVector3(l.centroidWorld);l.centroidScreen.copy(l.centroidWorld);w.multiplyVector3(l.centroidScreen);j=C.vertexNormals;L=0;for(D=j.length;L<D;L++)W=l.vertexNormalsWorld[L],W.copy(j[L]),N.multiplyVector3(W);L=0;for(D=I.length;L<D;L++)if(Y=I[L][B]){j=0;for(W=Y.length;j<W;j++)l.uvs[L][j]=Y[j]}l.material=O;l.faceMaterial=C.materialIndex!==null?_[C.materialIndex]:null;l.z=l.centroidScreen.z;x.elements.push(l)}}else if(P instanceof THREE.Line){M.multiply(w,A);B=P.geometry.vertices;L=i();L.positionScreen.copy(B[0].position);M.multiplyVector4(L.positionScreen);V=1;for(C=B.length;V<C;V++)if(L=i(),L.positionScreen.copy(B[V].position),M.multiplyVector4(L.positionScreen),D=c[h-2],S.copy(L.positionScreen),z.copy(D.positionScreen),n(S,z))S.multiplyScalar(1/S.w),z.multiplyScalar(1/z.w),P=g[m]=g[m]||new THREE.RenderableLine,m++,u=P,u.v1.positionScreen.copy(S),u.v2.positionScreen.copy(z),u.z=Math.max(S.z,z.z),u.material=O,x.elements.push(u)}t=0;for(b=x.sprites.length;t<b;t++)if(P=x.sprites[t].object,A=P.matrixWorld,P instanceof THREE.Particle&&(H.set(A.n14,A.n24,A.n34,1),w.multiplyVector4(H),H.z/=H.w,H.z>0&&H.z<1))s=y[R]=y[R]||new THREE.RenderableParticle,R++,T=s,T.x=H.x/H.w,T.y=H.y/H.w,T.z=H.z,T.rotation=P.rotation.z,T.scale.x=P.scale.x*Math.abs(T.x-(H.x+o.projectionMatrix.n11)/(H.w+o.projectionMatrix.n14)),T.scale.y=P.scale.y*Math.abs(T.y-(H.y+o.projectionMatrix.n22)/(H.w+o.projectionMatrix.n24)),T.material=P.material,x.elements.push(T);r&&x.elements.sort(e);return x}};THREE.Quaternion=function(t,i,e,n){this.set(t||0,i||0,e||0,n!==void 0?n:1)};THREE.Quaternion.prototype={constructor:THREE.Quaternion,set:function(t,i,e,n){this.x=t;this.y=i;this.z=e;this.w=n;return this},copy:function(t){this.x=t.x;this.y=t.y;this.z=t.z;this.w=t.w;return this},setFromEuler:function(t){var i=Math.PI/360,e=t.x*i,n=t.y*i,o=t.z*i,t=Math.cos(n),n=Math.sin(n),i=Math.cos(-o),o=Math.sin(-o),r=Math.cos(e),e=Math.sin(e),s=t*i,a=n*o;this.w=s*r-a*e;this.x=s*e+a*r;this.y=n*i*r+t*o*e;this.z=t*o*r-n*i*e;return this},setFromAxisAngle:function(t,i){var e=i/2,n=Math.sin(e);this.x=t.x*n;this.y=t.y*n;this.z=t.z*n;this.w=Math.cos(e);return this},setFromRotationMatrix:function(t){var i=Math.pow(t.determinant(),1/3);this.w=Math.sqrt(Math.max(0,i+t.n11+t.n22+t.n33))/2;this.x=Math.sqrt(Math.max(0,i+t.n11-t.n22-t.n33))/2;this.y=Math.sqrt(Math.max(0,i-t.n11+t.n22-t.n33))/2;this.z=Math.sqrt(Math.max(0,i-t.n11-t.n22+t.n33))/2;this.x=t.n32-t.n23<0?-Math.abs(this.x):Math.abs(this.x);this.y=t.n13-t.n31<0?-Math.abs(this.y):Math.abs(this.y);this.z=t.n21-t.n12<0?-Math.abs(this.z):Math.abs(this.z);this.normalize();return this},calculateW:function(){this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z));return this
},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);t===0?this.w=this.z=this.y=this.x=0:(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t);return this},multiplySelf:function(t){var i=this.x,e=this.y,n=this.z,o=this.w,r=t.x,s=t.y,a=t.z,t=t.w;this.x=i*t+o*r+e*a-n*s;this.y=e*t+o*s+n*r-i*a;this.z=n*t+o*a+i*s-e*r;this.w=o*t-i*r-e*s-n*a;return this},multiply:function(t,i){this.x=t.x*i.w+t.y*i.z-t.z*i.y+t.w*i.x;this.y=-t.x*i.z+t.y*i.w+t.z*i.x+t.w*i.y;this.z=t.x*i.y-t.y*i.x+t.z*i.w+t.w*i.z;this.w=-t.x*i.x-t.y*i.y-t.z*i.z+t.w*i.w;return this},multiplyVector3:function(t,i){i||(i=t);var e=t.x,n=t.y,o=t.z,r=this.x,s=this.y,a=this.z,h=this.w,c=h*e+s*o-a*n,l=h*n+a*e-r*o,E=h*o+r*n-s*e,e=-r*e-s*n-a*o;i.x=c*h+e*-r+l*-a-E*-s;i.y=l*h+e*-s+E*-r-c*-a;i.z=E*h+e*-a+c*-s-l*-r;return i}};THREE.Quaternion.slerp=function(t,i,e,n){var o=t.w*i.w+t.x*i.x+t.y*i.y+t.z*i.z;o<0?(e.w=-i.w,e.x=-i.x,e.y=-i.y,e.z=-i.z,o=-o):e.copy(i);if(Math.abs(o)>=1)return e.w=t.w,e.x=t.x,e.y=t.y,e.z=t.z,e;var r=Math.acos(o),o=Math.sqrt(1-o*o);if(Math.abs(o)<.001)return e.w=.5*(t.w+i.w),e.x=.5*(t.x+i.x),e.y=.5*(t.y+i.y),e.z=.5*(t.z+i.z),e;i=Math.sin((1-n)*r)/o;n=Math.sin(n*r)/o;e.w=t.w*i+e.w*n;e.x=t.x*i+e.x*n;e.y=t.y*i+e.y*n;e.z=t.z*i+e.z*n;return e};THREE.Vertex=function(t){this.position=t||new THREE.Vector3};THREE.Face3=function(t,i,e,n,o,r){this.a=t;this.b=i;this.c=e;this.normal=n instanceof THREE.Vector3?n:new THREE.Vector3;this.vertexNormals=n instanceof Array?n:[];this.color=o instanceof THREE.Color?o:new THREE.Color;this.vertexColors=o instanceof Array?o:[];this.vertexTangents=[];this.materialIndex=r;this.centroid=new THREE.Vector3};THREE.Face4=function(t,i,e,n,o,r,s){this.a=t;this.b=i;this.c=e;this.d=n;this.normal=o instanceof THREE.Vector3?o:new THREE.Vector3;this.vertexNormals=o instanceof Array?o:[];this.color=r instanceof THREE.Color?r:new THREE.Color;this.vertexColors=r instanceof Array?r:[];this.vertexTangents=[];this.materialIndex=s;this.centroid=new THREE.Vector3};THREE.UV=function(t,i){this.u=t||0;this.v=i||0};THREE.UV.prototype={constructor:THREE.UV,set:function(t,i){this.u=t;this.v=i;return this},copy:function(t){this.u=t.u;this.v=t.v;return this},clone:function(){return new THREE.UV(this.u,this.v)}};THREE.Geometry=function(){this.id=THREE.GeometryCount++;this.vertices=[];this.colors=[];this.materials=[];this.faces=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.dynamic=this.hasTangents=!1};THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(t){var i=new THREE.Matrix4;i.extractRotation(t,new THREE.Vector3(1,1,1));for(var e=0,n=this.vertices.length;e<n;e++)t.multiplyVector3(this.vertices[e].position);e=0;for(n=this.faces.length;e<n;e++){var o=this.faces[e];i.multiplyVector3(o.normal);for(var r=0,s=o.vertexNormals.length;r<s;r++)i.multiplyVector3(o.vertexNormals[r]);t.multiplyVector3(o.centroid)}},computeCentroids:function(){var t,i,e;t=0;for(i=this.faces.length;t<i;t++)e=this.faces[t],e.centroid.set(0,0,0),e instanceof THREE.Face3?(e.centroid.addSelf(this.vertices[e.a].position),e.centroid.addSelf(this.vertices[e.b].position),e.centroid.addSelf(this.vertices[e.c].position),e.centroid.divideScalar(3)):e instanceof THREE.Face4&&(e.centroid.addSelf(this.vertices[e.a].position),e.centroid.addSelf(this.vertices[e.b].position),e.centroid.addSelf(this.vertices[e.c].position),e.centroid.addSelf(this.vertices[e.d].position),e.centroid.divideScalar(4))},computeFaceNormals:function(){var t,i,e,n,o,r,s=new THREE.Vector3,a=new THREE.Vector3;t=0;for(i=this.faces.length;t<i;t++)e=this.faces[t],n=this.vertices[e.a],o=this.vertices[e.b],r=this.vertices[e.c],s.sub(r.position,o.position),a.sub(n.position,o.position),s.crossSelf(a),s.isZero()||s.normalize(),e.normal.copy(s)},computeVertexNormals:function(){var t,i,e,n;if(this.__tmpVertices===void 0){n=this.__tmpVertices=Array(this.vertices.length);t=0;for(i=this.vertices.length;t<i;t++)n[t]=new THREE.Vector3;t=0;for(i=this.faces.length;t<i;t++)if(e=this.faces[t],e instanceof THREE.Face3)e.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];else if(e instanceof THREE.Face4)e.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}else{n=this.__tmpVertices;t=0;for(i=this.vertices.length;t<i;t++)n[t].set(0,0,0)}t=0;for(i=this.faces.length;t<i;t++)e=this.faces[t],e instanceof THREE.Face3?(n[e.a].addSelf(e.normal),n[e.b].addSelf(e.normal),n[e.c].addSelf(e.normal)):e instanceof THREE.Face4&&(n[e.a].addSelf(e.normal),n[e.b].addSelf(e.normal),n[e.c].addSelf(e.normal),n[e.d].addSelf(e.normal));t=0;for(i=this.vertices.length;t<i;t++)n[t].normalize();t=0;for(i=this.faces.length;t<i;t++)e=this.faces[t],e instanceof THREE.Face3?(e.vertexNormals[0].copy(n[e.a]),e.vertexNormals[1].copy(n[e.b]),e.vertexNormals[2].copy(n[e.c])):e instanceof THREE.Face4&&(e.vertexNormals[0].copy(n[e.a]),e.vertexNormals[1].copy(n[e.b]),e.vertexNormals[2].copy(n[e.c]),e.vertexNormals[3].copy(n[e.d]))},computeTangents:function(){function t(t,i,e,n,o,r,w){a=t.vertices[i].position;h=t.vertices[e].position;c=t.vertices[n].position;l=s[o];E=s[r];p=s[w];f=h.x-a.x;d=c.x-a.x;u=h.y-a.y;m=c.y-a.y;g=h.z-a.z;T=c.z-a.z;R=E.u-l.u;y=p.u-l.u;x=E.v-l.v;v=p.v-l.v;H=1/(R*v-y*x);S.set((v*f-x*d)*H,(v*u-x*m)*H,(v*g-x*T)*H);z.set((R*d-y*f)*H,(R*m-y*u)*H,(R*T-y*g)*H);M[i].addSelf(S);M[e].addSelf(S);M[n].addSelf(S);b[i].addSelf(z);b[e].addSelf(z);b[n].addSelf(z)}var i,e,n,o,r,s,a,h,c,l,E,p,f,d,u,m,g,T,R,y,x,v,H,w,M=[],b=[],S=new THREE.Vector3,z=new THREE.Vector3,V=new THREE.Vector3,C=new THREE.Vector3,B=new THREE.Vector3;i=0;for(e=this.vertices.length;i<e;i++)M[i]=new THREE.Vector3,b[i]=new THREE.Vector3;i=0;for(e=this.faces.length;i<e;i++)r=this.faces[i],s=this.faceVertexUvs[0][i],r instanceof THREE.Face3?t(this,r.a,r.b,r.c,0,1,2):r instanceof THREE.Face4&&(t(this,r.a,r.b,r.c,0,1,2),t(this,r.a,r.b,r.d,0,1,3));var L=["a","b","c","d"];i=0;for(e=this.faces.length;i<e;i++){r=this.faces[i];for(n=0;n<r.vertexNormals.length;n++)B.copy(r.vertexNormals[n]),o=r[L[n]],w=M[o],V.copy(w),V.subSelf(B.multiplyScalar(B.dot(w))).normalize(),C.cross(r.vertexNormals[n],w),o=C.dot(b[o]),o=o<0?-1:1,r.vertexTangents[n]=new THREE.Vector4(V.x,V.y,V.z,o)}this.hasTangents=!0},computeBoundingBox:function(){var t;if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var i=1,e=this.vertices.length;i<e;i++){t=this.vertices[i];if(t.position.x<this.boundingBox.x[0])this.boundingBox.x[0]=t.position.x;else if(t.position.x>this.boundingBox.x[1])this.boundingBox.x[1]=t.position.x;if(t.position.y<this.boundingBox.y[0])this.boundingBox.y[0]=t.position.y;else if(t.position.y>this.boundingBox.y[1])this.boundingBox.y[1]=t.position.y;if(t.position.z<this.boundingBox.z[0])this.boundingBox.z[0]=t.position.z;else if(t.position.z>this.boundingBox.z[1])this.boundingBox.z[1]=t.position.z}}},computeBoundingSphere:function(){for(var t=0,i=0,e=this.vertices.length;i<e;i++)t=Math.max(t,this.vertices[i].position.length());this.boundingSphere={radius:t}},mergeVertices:function(){var t={},i=[],e=[],n,o=Math.pow(10,4),r,s;r=0;for(s=this.vertices.length;r<s;r++)n=this.vertices[r].position,n=[Math.round(n.x*o),Math.round(n.y*o),Math.round(n.z*o)].join("_"),t[n]===void 0?(t[n]=r,i.push(this.vertices[r]),e[r]=i.length-1):e[r]=e[t[n]];r=0;for(s=this.faces.length;r<s;r++)if(t=this.faces[r],t instanceof THREE.Face3)t.a=e[t.a],t.b=e[t.b],t.c=e[t.c];else if(t instanceof THREE.Face4)t.a=e[t.a],t.b=e[t.b],t.c=e[t.c],t.d=e[t.d];this.vertices=i}};THREE.GeometryCount=0;THREE.Camera=function(){if(arguments.length)return console.warn("DEPRECATED: Camera() is now PerspectiveCamera() or OrthographicCamera()."),new THREE.PerspectiveCamera(arguments[0],arguments[1],arguments[2],arguments[3]);THREE.Object3D.call(this);this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4;this.projectionMatrixInverse=new THREE.Matrix4};THREE.Camera.prototype=new THREE.Object3D;THREE.Camera.prototype.constructor=THREE.Camera;THREE.Camera.prototype.lookAt=function(t){this.matrix.lookAt(this.position,t,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)};THREE.OrthographicCamera=function(t,i,e,n,o,r){THREE.Camera.call(this);this.left=t;this.right=i;this.top=e;this.bottom=n;this.near=o!==void 0?o:.1;this.far=r!==void 0?r:2e3;this.updateProjectionMatrix()};THREE.OrthographicCamera.prototype=new THREE.Camera;THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera;THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix=THREE.Matrix4.makeOrtho(this.left,this.right,this.top,this.bottom,this.near,this.far)};THREE.PerspectiveCamera=function(t,i,e,n){THREE.Camera.call(this);this.fov=t!==void 0?t:50;this.aspect=i!==void 0?i:1;this.near=e!==void 0?e:.1;this.far=n!==void 0?n:2e3;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype=new THREE.Camera;THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera;THREE.PerspectiveCamera.prototype.setLens=function(t,i){this.fov=2*Math.atan((i!==void 0?i:43.25)/(t*2));this.fov*=180/Math.PI;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.setViewOffset=function(t,i,e,n,o,r){this.fullWidth=t;this.fullHeight=i;this.x=e;this.y=n;this.width=o;this.height=r;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var t=this.fullWidth/this.fullHeight,i=Math.tan(this.fov*Math.PI/360)*this.near,e=-i,n=t*e,t=Math.abs(t*i-n),e=Math.abs(i-e);this.projectionMatrix=THREE.Matrix4.makeFrustum(n+this.x*t/this.fullWidth,n+(this.x+this.width)*t/this.fullWidth,i-(this.y+this.height)*e/this.fullHeight,i-this.y*e/this.fullHeight,this.near,this.far)}else this.projectionMatrix=THREE.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)};THREE.Light=function(t){THREE.Object3D.call(this);this.color=new THREE.Color(t)};THREE.Light.prototype=new THREE.Object3D;THREE.Light.prototype.constructor=THREE.Light;THREE.Light.prototype.supr=THREE.Object3D.prototype;THREE.AmbientLight=function(t){THREE.Light.call(this,t)};THREE.AmbientLight.prototype=new THREE.Light;THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.DirectionalLight=function(t,i,e){THREE.Light.call(this,t);this.position=new THREE.Vector3(0,1,0);this.intensity=i!==void 0?i:1;this.distance=e!==void 0?e:0};THREE.DirectionalLight.prototype=new THREE.Light;THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;THREE.PointLight=function(t,i,e){THREE.Light.call(this,t);this.position=new THREE.Vector3(0,0,0);this.intensity=i!==void 0?i:1;this.distance=e!==void 0?e:0};THREE.PointLight.prototype=new THREE.Light;THREE.PointLight.prototype.constructor=THREE.PointLight;THREE.Material=function(t){this.name="";this.id=THREE.MaterialCount++;t=t||{};this.opacity=t.opacity!==void 0?t.opacity:1;this.transparent=t.transparent!==void 0?t.transparent:!1;this.blending=t.blending!==void 0?t.blending:THREE.NormalBlending;this.depthTest=t.depthTest!==void 0?t.depthTest:!0;this.depthWrite=t.depthWrite!==void 0?t.depthWrite:!0;this.polygonOffset=t.polygonOffset!==void 0?t.polygonOffset:!1;this.polygonOffsetFactor=t.polygonOffsetFactor!==void 0?t.polygonOffsetFactor:0;this.polygonOffsetUnits=t.polygonOffsetUnits!==void 0?t.polygonOffsetUnits:0;this.alphaTest=t.alphaTest!==void 0?t.alphaTest:0;this.overdraw=t.overdraw!==void 0?t.overdraw:!1};THREE.MaterialCount=0;THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NormalBlending=0;THREE.AdditiveBlending=1;THREE.SubtractiveBlending=2;THREE.MultiplyBlending=3;THREE.AdditiveAlphaBlending=4;THREE.LineBasicMaterial=function(t){THREE.Material.call(this,t);t=t||{};this.color=t.color!==void 0?new THREE.Color(t.color):new THREE.Color(16777215);this.linewidth=t.linewidth!==void 0?t.linewidth:1;this.linecap=t.linecap!==void 0?t.linecap:"round";this.linejoin=t.linejoin!==void 0?t.linejoin:"round";this.vertexColors=t.vertexColors?t.vertexColors:!1;this.fog=t.fog!==void 0?t.fog:!0};THREE.LineBasicMaterial.prototype=new THREE.Material;THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;THREE.MeshBasicMaterial=function(t){THREE.Material.call(this,t);t=t||{};this.color=t.color!==void 0?new THREE.Color(t.color):new THREE.Color(16777215);this.map=t.map!==void 0?t.map:null;this.lightMap=t.lightMap!==void 0?t.lightMap:null;this.envMap=t.envMap!==void 0?t.envMap:null;this.combine=t.combine!==void 0?t.combine:THREE.MultiplyOperation;this.reflectivity=t.reflectivity!==void 0?t.reflectivity:1;this.refractionRatio=t.refractionRatio!==void 0?t.refractionRatio:.98;this.fog=t.fog!==void 0?t.fog:!0;this.shading=t.shading!==void 0?t.shading:THREE.SmoothShading;this.wireframe=t.wireframe!==void 0?t.wireframe:!1;this.wireframeLinewidth=t.wireframeLinewidth!==void 0?t.wireframeLinewidth:1;this.wireframeLinecap=t.wireframeLinecap!==void 0?t.wireframeLinecap:"round";this.wireframeLinejoin=t.wireframeLinejoin!==void 0?t.wireframeLinejoin:"round";this.vertexColors=t.vertexColors!==void 0?t.vertexColors:!1;this.skinning=t.skinning!==void 0?t.skinning:!1;this.morphTargets=t.morphTargets!==void 0?t.morphTargets:!1};THREE.MeshBasicMaterial.prototype=new THREE.Material;THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;THREE.MeshLambertMaterial=function(t){THREE.Material.call(this,t);t=t||{};this.color=t.color!==void 0?new THREE.Color(t.color):new THREE.Color(16777215);this.ambient=t.ambient!==void 0?new THREE.Color(t.ambient):new THREE.Color(328965);this.map=t.map!==void 0?t.map:null;this.lightMap=t.lightMap!==void 0?t.lightMap:null;this.envMap=t.envMap!==void 0?t.envMap:null;this.combine=t.combine!==void 0?t.combine:THREE.MultiplyOperation;this.reflectivity=t.reflectivity!==void 0?t.reflectivity:1;this.refractionRatio=t.refractionRatio!==void 0?t.refractionRatio:.98;this.fog=t.fog!==void 0?t.fog:!0;this.shading=t.shading!==void 0?t.shading:THREE.SmoothShading;this.wireframe=t.wireframe!==void 0?t.wireframe:!1;this.wireframeLinewidth=t.wireframeLinewidth!==void 0?t.wireframeLinewidth:1;this.wireframeLinecap=t.wireframeLinecap!==void 0?t.wireframeLinecap:"round";this.wireframeLinejoin=t.wireframeLinejoin!==void 0?t.wireframeLinejoin:"round";this.vertexColors=t.vertexColors!==void 0?t.vertexColors:!1;this.skinning=t.skinning!==void 0?t.skinning:!1;this.morphTargets=t.morphTargets!==void 0?t.morphTargets:!1};THREE.MeshLambertMaterial.prototype=new THREE.Material;THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;THREE.MeshPhongMaterial=function(t){THREE.Material.call(this,t);t=t||{};this.color=t.color!==void 0?new THREE.Color(t.color):new THREE.Color(16777215);this.ambient=t.ambient!==void 0?new THREE.Color(t.ambient):new THREE.Color(328965);this.specular=t.specular!==void 0?new THREE.Color(t.specular):new THREE.Color(1118481);this.shininess=t.shininess!==void 0?t.shininess:30;this.metal=t.metal!==void 0?t.metal:!1;this.perPixel=t.perPixel!==void 0?t.perPixel:!1;this.map=t.map!==void 0?t.map:null;this.lightMap=t.lightMap!==void 0?t.lightMap:null;this.envMap=t.envMap!==void 0?t.envMap:null;this.combine=t.combine!==void 0?t.combine:THREE.MultiplyOperation;this.reflectivity=t.reflectivity!==void 0?t.reflectivity:1;this.refractionRatio=t.refractionRatio!==void 0?t.refractionRatio:.98;this.fog=t.fog!==void 0?t.fog:!0;this.shading=t.shading!==void 0?t.shading:THREE.SmoothShading;this.wireframe=t.wireframe!==void 0?t.wireframe:!1;this.wireframeLinewidth=t.wireframeLinewidth!==void 0?t.wireframeLinewidth:1;this.wireframeLinecap=t.wireframeLinecap!==void 0?t.wireframeLinecap:"round";this.wireframeLinejoin=t.wireframeLinejoin!==void 0?t.wireframeLinejoin:"round";this.vertexColors=t.vertexColors!==void 0?t.vertexColors:!1;this.skinning=t.skinning!==void 0?t.skinning:!1;this.morphTargets=t.morphTargets!==void 0?t.morphTargets:!1};THREE.MeshPhongMaterial.prototype=new THREE.Material;THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;THREE.MeshDepthMaterial=function(t){THREE.Material.call(this,t);t=t||{};this.shading=t.shading!==void 0?t.shading:THREE.SmoothShading;this.wireframe=t.wireframe!==void 0?t.wireframe:!1;this.wireframeLinewidth=t.wireframeLinewidth!==void 0?t.wireframeLinewidth:1};THREE.MeshDepthMaterial.prototype=new THREE.Material;THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;THREE.MeshNormalMaterial=function(t){THREE.Material.call(this,t);t=t||{};this.shading=t.shading?t.shading:THREE.FlatShading;this.wireframe=t.wireframe?t.wireframe:!1;this.wireframeLinewidth=t.wireframeLinewidth?t.wireframeLinewidth:1};THREE.MeshNormalMaterial.prototype=new THREE.Material;THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshFaceMaterial=function(){};THREE.ParticleBasicMaterial=function(t){THREE.Material.call(this,t);t=t||{};this.color=t.color!==void 0?new THREE.Color(t.color):new THREE.Color(16777215);this.map=t.map!==void 0?t.map:null;this.size=t.size!==void 0?t.size:1;this.sizeAttenuation=t.sizeAttenuation!==void 0?t.sizeAttenuation:!0;this.vertexColors=t.vertexColors!==void 0?t.vertexColors:!1;this.fog=t.fog!==void 0?t.fog:!0};THREE.ParticleBasicMaterial.prototype=new THREE.Material;THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial;THREE.ParticleCanvasMaterial=function(t){THREE.Material.call(this,t);t=t||{};this.color=t.color!==void 0?new THREE.Color(t.color):new THREE.Color(16777215);this.program=t.program!==void 0?t.program:function(){}};THREE.ParticleCanvasMaterial.prototype=new THREE.Material;THREE.ParticleCanvasMaterial.prototype.constructor=THREE.ParticleCanvasMaterial;THREE.Texture=function(t,i,e,n,o,r){this.id=THREE.TextureCount++;this.image=t;this.mapping=i!==void 0?i:new THREE.UVMapping;this.wrapS=e!==void 0?e:THREE.ClampToEdgeWrapping;this.wrapT=n!==void 0?n:THREE.ClampToEdgeWrapping;this.magFilter=o!==void 0?o:THREE.LinearFilter;this.minFilter=r!==void 0?r:THREE.LinearMipMapLinearFilter;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.needsUpdate=!1;this.onUpdate=null};THREE.Texture.prototype={constructor:THREE.Texture,clone:function(){var t=new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);t.offset.copy(this.offset);t.repeat.copy(this.repeat);return t}};THREE.TextureCount=0;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.LatitudeReflectionMapping=function(){};THREE.LatitudeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.UVMapping=function(){};THREE.RepeatWrapping=0;THREE.ClampToEdgeWrapping=1;THREE.MirroredRepeatWrapping=2;THREE.NearestFilter=3;THREE.NearestMipMapNearestFilter=4;THREE.NearestMipMapLinearFilter=5;THREE.LinearFilter=6;THREE.LinearMipMapNearestFilter=7;THREE.LinearMipMapLinearFilter=8;THREE.ByteType=9;THREE.UnsignedByteType=10;THREE.ShortType=11;THREE.UnsignedShortType=12;THREE.IntType=13;THREE.UnsignedIntType=14;THREE.FloatType=15;THREE.AlphaFormat=16;THREE.RGBFormat=17;THREE.RGBAFormat=18;THREE.LuminanceFormat=19;THREE.LuminanceAlphaFormat=20;THREE.Particle=function(t){THREE.Object3D.call(this);this.material=t};THREE.Particle.prototype=new THREE.Object3D;THREE.Particle.prototype.constructor=THREE.Particle;THREE.Line=function(t,i,e){THREE.Object3D.call(this);this.geometry=t;this.material=i;this.type=e!==void 0?e:THREE.LineStrip;this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=new THREE.Object3D;THREE.Line.prototype.constructor=THREE.Line;THREE.Mesh=function(t,i){THREE.Object3D.call(this);this.geometry=t;this.material=i;if(i instanceof Array)console.warn("DEPRECATED: Mesh material can no longer be an Array. Using material at index 0..."),this.material=i[0];if(this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=t.boundingSphere.radius,this.geometry.morphTargets.length)){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var e=0;e<this.geometry.morphTargets.length;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}};THREE.Mesh.prototype=new THREE.Object3D;THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Mesh.prototype.supr=THREE.Object3D.prototype;THREE.Mesh.prototype.getMorphTargetIndexByName=function(t){if(this.morphTargetDictionary[t]!==void 0)return this.morphTargetDictionary[t];console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+t+" does not exist. Returning 0.");return 0};THREE.Bone=function(t){THREE.Object3D.call(this);this.skin=t;this.skinMatrix=new THREE.Matrix4};THREE.Bone.prototype=new THREE.Object3D;THREE.Bone.prototype.constructor=THREE.Bone;THREE.Bone.prototype.supr=THREE.Object3D.prototype;THREE.Bone.prototype.update=function(t,i){this.matrixAutoUpdate&&(i|=this.updateMatrix());if(i||this.matrixWorldNeedsUpdate)t?this.skinMatrix.multiply(t,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,i=!0;var e,n=this.children.length;for(e=0;e<n;e++)this.children[e].update(this.skinMatrix,i)};THREE.Sprite=function(t){THREE.Object3D.call(this);this.color=t.color!==void 0?new THREE.Color(t.color):new THREE.Color(16777215);this.map=t.map instanceof THREE.Texture?t.map:THREE.ImageUtils.loadTexture(t.map);this.blending=t.blending!==void 0?t.blending:THREE.NormalBlending;this.useScreenCoordinates=t.useScreenCoordinates!==void 0?t.useScreenCoordinates:!0;this.mergeWith3D=t.mergeWith3D!==void 0?t.mergeWith3D:!this.useScreenCoordinates;this.affectedByDistance=t.affectedByDistance!==void 0?t.affectedByDistance:!this.useScreenCoordinates;this.scaleByViewport=t.scaleByViewport!==void 0?t.scaleByViewport:!this.affectedByDistance;this.alignment=t.alignment instanceof THREE.Vector2?t.alignment:THREE.SpriteAlignment.center;this.rotation3d=this.rotation;this.rotation=0;this.opacity=1;this.uvOffset=new THREE.Vector2(0,0);this.uvScale=new THREE.Vector2(1,1)};THREE.Sprite.prototype=new THREE.Object3D;THREE.Sprite.prototype.constructor=THREE.Sprite;THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position);this.rotation3d.set(0,0,this.rotation);this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1)this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,this.scale.y);this.matrixWorldNeedsUpdate=!0};THREE.SpriteAlignment={};THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1);THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1);THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1);THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0);THREE.SpriteAlignment.center=new THREE.Vector2(0,0);THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0);THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1);THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1);THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1);THREE.Scene=function(){THREE.Object3D.call(this);this.overrideMaterial=this.fog=null;this.matrixAutoUpdate=!1;this.objects=[];this.lights=[];this.__objectsAdded=[];this.__objectsRemoved=[]};THREE.Scene.prototype=new THREE.Object3D;THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.addObject=function(t){if(t instanceof THREE.Light)this.lights.indexOf(t)===-1&&this.lights.push(t);else if(!(t instanceof THREE.Camera||t instanceof THREE.Bone)&&this.objects.indexOf(t)===-1){this.objects.push(t);this.__objectsAdded.push(t);var i=this.__objectsRemoved.indexOf(t);i!==-1&&this.__objectsRemoved.splice(i,1)}for(i=0;i<t.children.length;i++)this.addObject(t.children[i])};THREE.Scene.prototype.removeObject=function(t){if(t instanceof THREE.Light){var i=this.lights.indexOf(t);i!==-1&&this.lights.splice(i,1)}else t instanceof THREE.Camera||(i=this.objects.indexOf(t),i!==-1&&(this.objects.splice(i,1),this.__objectsRemoved.push(t),i=this.__objectsAdded.indexOf(t),i!==-1&&this.__objectsAdded.splice(i,1)));for(i=0;i<t.children.length;i++)this.removeObject(t.children[i])};THREE.CanvasRenderer=function(t){function i(t){if(T!=t)u.globalAlpha=T=t}function e(t){if(R!=t){switch(t){case THREE.NormalBlending:u.globalCompositeOperation="source-over";break;case THREE.AdditiveBlending:u.globalCompositeOperation="lighter";break;case THREE.SubtractiveBlending:u.globalCompositeOperation="darker"}R=t}}function n(t){if(y!=t)u.strokeStyle=y=t}function o(t){if(x!=t)u.fillStyle=x=t}var r=this,s,a,h,c=new THREE.Projector,t=t||{},l=t.canvas!==void 0?t.canvas:document.createElement("canvas"),E,p,f,d,u=l.getContext("2d"),m=new THREE.Color(0),g=0,T=1,R=0,y=null,x=null,v=null,H=null,w=null,M,b,S,z,V=new THREE.RenderableVertex,C=new THREE.RenderableVertex,B,L,D,j,W,P,A,N,O,_,F,I,Y=new THREE.Color,K=new THREE.Color,k=new THREE.Color,U=new THREE.Color,q=new THREE.Color,X=[],G=[],Q,Z,$,J,ti,ii,ei,ni,oi,ri,si=new THREE.Rectangle,ai=new THREE.Rectangle,hi=new THREE.Rectangle,ci=!1,li=new THREE.Color,Ei=new THREE.Color,pi=new THREE.Color,fi=new THREE.Vector3,di,ui,mi,gi,Ti,Ri,t=16;di=document.createElement("canvas");di.width=di.height=2;ui=di.getContext("2d");ui.fillStyle="rgba(0,0,0,1)";ui.fillRect(0,0,2,2);mi=ui.getImageData(0,0,2,2);gi=mi.data;Ti=document.createElement("canvas");Ti.width=Ti.height=t;Ri=Ti.getContext("2d");Ri.translate(-t/2,-t/2);Ri.scale(t,t);t--;this.domElement=l;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.setSize=function(t,i){E=t;p=i;f=Math.floor(E/2);d=Math.floor(p/2);l.width=E;l.height=p;si.set(-f,-d,f,d);ai.set(-f,-d,f,d);T=1;R=0;w=H=v=x=y=null};this.setClearColor=function(t,i){m.copy(t);g=i;ai.set(-f,-d,f,d)};this.setClearColorHex=function(t,i){m.setHex(t);g=i;ai.set(-f,-d,f,d)};this.clear=function(){u.setTransform(1,0,0,-1,f,d);ai.isEmpty()||(ai.minSelf(si),ai.inflate(2),g<1&&u.clearRect(Math.floor(ai.getX()),Math.floor(ai.getY()),Math.floor(ai.getWidth()),Math.floor(ai.getHeight())),g>0&&(e(THREE.NormalBlending),i(1),o("rgba("+Math.floor(m.r*255)+","+Math.floor(m.g*255)+","+Math.floor(m.b*255)+","+g+")"),u.fillRect(Math.floor(ai.getX()),Math.floor(ai.getY()),Math.floor(ai.getWidth()),Math.floor(ai.getHeight()))),ai.empty())};this.render=function(t,l){function E(t){var i,e,n,o;li.setRGB(0,0,0);Ei.setRGB(0,0,0);pi.setRGB(0,0,0);i=0;for(e=t.length;i<e;i++)n=t[i],o=n.color,n instanceof THREE.AmbientLight?(li.r+=o.r,li.g+=o.g,li.b+=o.b):n instanceof THREE.DirectionalLight?(Ei.r+=o.r,Ei.g+=o.g,Ei.b+=o.b):n instanceof THREE.PointLight&&(pi.r+=o.r,pi.g+=o.g,pi.b+=o.b)}function p(t,i,e,n){var o,r,s,a,h,c;o=0;for(r=t.length;o<r;o++)s=t[o],a=s.color,s instanceof THREE.DirectionalLight?(h=s.matrixWorld.getPosition(),c=e.dot(h),c<=0||(c*=s.intensity,n.r+=a.r*c,n.g+=a.g*c,n.b+=a.b*c)):s instanceof THREE.PointLight&&(h=s.matrixWorld.getPosition(),c=e.dot(fi.sub(h,i).normalize()),c<=0||(c*=s.distance==0?1:1-Math.min(i.distanceTo(h)/s.distance,1),c!=0&&(c*=s.intensity,n.r+=a.r*c,n.g+=a.g*c,n.b+=a.b*c)))}function m(t,r,s){i(s.opacity);e(s.blending);var a,h,c,l,E,p;if(s instanceof THREE.ParticleBasicMaterial){if(s.map)l=s.map.image,E=l.width>>1,p=l.height>>1,s=r.scale.x*f,c=r.scale.y*d,a=s*E,h=c*p,hi.set(t.x-a,t.y-h,t.x+a,t.y+h),si.intersects(hi)&&(u.save(),u.translate(t.x,t.y),u.rotate(-r.rotation),u.scale(s,-c),u.translate(-E,-p),u.drawImage(l,0,0),u.restore())}else s instanceof THREE.ParticleCanvasMaterial&&(a=r.scale.x*f,h=r.scale.y*d,hi.set(t.x-a,t.y-h,t.x+a,t.y+h),si.intersects(hi)&&(n(s.color.getContextStyle()),o(s.color.getContextStyle()),u.save(),u.translate(t.x,t.y),u.rotate(-r.rotation),u.scale(a,h),s.program(u),u.restore()))}function g(t,o,r,s){i(s.opacity);e(s.blending);u.beginPath();u.moveTo(t.positionScreen.x,t.positionScreen.y);u.lineTo(o.positionScreen.x,o.positionScreen.y);u.closePath();if(s instanceof THREE.LineBasicMaterial){t=s.linewidth;if(v!=t)u.lineWidth=v=t;t=s.linecap;if(H!=t)u.lineCap=H=t;t=s.linejoin;if(w!=t)u.lineJoin=w=t;n(s.color.getContextStyle());u.stroke();hi.inflate(s.linewidth*2)}}function T(t,n,o,s,a,c,E,f){r.info.render.vertices+=3;r.info.render.faces++;i(f.opacity);e(f.blending);B=t.positionScreen.x;L=t.positionScreen.y;D=n.positionScreen.x;j=n.positionScreen.y;W=o.positionScreen.x;P=o.positionScreen.y;y(B,L,D,j,W,P);if(f instanceof THREE.MeshBasicMaterial)if(f.map)f.map.mapping instanceof THREE.UVMapping&&(J=E.uvs[0],vi(B,L,D,j,W,P,J[s].u,J[s].v,J[a].u,J[a].v,J[c].u,J[c].v,f.map));else if(f.envMap){if(f.envMap.mapping instanceof THREE.SphericalReflectionMapping)t=l.matrixWorldInverse,fi.copy(E.vertexNormalsWorld[s]),ti=(fi.x*t.n11+fi.y*t.n12+fi.z*t.n13)*.5+.5,ii=-(fi.x*t.n21+fi.y*t.n22+fi.z*t.n23)*.5+.5,fi.copy(E.vertexNormalsWorld[a]),ei=(fi.x*t.n11+fi.y*t.n12+fi.z*t.n13)*.5+.5,ni=-(fi.x*t.n21+fi.y*t.n22+fi.z*t.n23)*.5+.5,fi.copy(E.vertexNormalsWorld[c]),oi=(fi.x*t.n11+fi.y*t.n12+fi.z*t.n13)*.5+.5,ri=-(fi.x*t.n21+fi.y*t.n22+fi.z*t.n23)*.5+.5,vi(B,L,D,j,W,P,ti,ii,ei,ni,oi,ri,f.envMap)}else f.wireframe?yi(f.color,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):xi(f.color);else if(f instanceof THREE.MeshLambertMaterial)f.map&&!f.wireframe&&(f.map.mapping instanceof THREE.UVMapping&&(J=E.uvs[0],vi(B,L,D,j,W,P,J[s].u,J[s].v,J[a].u,J[a].v,J[c].u,J[c].v,f.map)),e(THREE.SubtractiveBlending)),ci?!f.wireframe&&f.shading==THREE.SmoothShading&&E.vertexNormalsWorld.length==3?(K.r=k.r=U.r=li.r,K.g=k.g=U.g=li.g,K.b=k.b=U.b=li.b,p(h,E.v1.positionWorld,E.vertexNormalsWorld[0],K),p(h,E.v2.positionWorld,E.vertexNormalsWorld[1],k),p(h,E.v3.positionWorld,E.vertexNormalsWorld[2],U),K.r=Math.max(0,Math.min(f.color.r*K.r,1)),K.g=Math.max(0,Math.min(f.color.g*K.g,1)),K.b=Math.max(0,Math.min(f.color.b*K.b,1)),k.r=Math.max(0,Math.min(f.color.r*k.r,1)),k.g=Math.max(0,Math.min(f.color.g*k.g,1)),k.b=Math.max(0,Math.min(f.color.b*k.b,1)),U.r=Math.max(0,Math.min(f.color.r*U.r,1)),U.g=Math.max(0,Math.min(f.color.g*U.g,1)),U.b=Math.max(0,Math.min(f.color.b*U.b,1)),q.r=(k.r+U.r)*.5,q.g=(k.g+U.g)*.5,q.b=(k.b+U.b)*.5,$=wi(K,k,U,q),Hi(B,L,D,j,W,P,0,0,1,0,0,1,$)):(Y.r=li.r,Y.g=li.g,Y.b=li.b,p(h,E.centroidWorld,E.normalWorld,Y),Y.r=Math.max(0,Math.min(f.color.r*Y.r,1)),Y.g=Math.max(0,Math.min(f.color.g*Y.g,1)),Y.b=Math.max(0,Math.min(f.color.b*Y.b,1)),f.wireframe?yi(Y,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):xi(Y)):f.wireframe?yi(f.color,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):xi(f.color);else if(f instanceof THREE.MeshDepthMaterial)Q=l.near,Z=l.far,K.r=K.g=K.b=1-Mi(t.positionScreen.z,Q,Z),k.r=k.g=k.b=1-Mi(n.positionScreen.z,Q,Z),U.r=U.g=U.b=1-Mi(o.positionScreen.z,Q,Z),q.r=(k.r+U.r)*.5,q.g=(k.g+U.g)*.5,q.b=(k.b+U.b)*.5,$=wi(K,k,U,q),Hi(B,L,D,j,W,P,0,0,1,0,0,1,$);else if(f instanceof THREE.MeshNormalMaterial)Y.r=bi(E.normalWorld.x),Y.g=bi(E.normalWorld.y),Y.b=bi(E.normalWorld.z),f.wireframe?yi(Y,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):xi(Y)}function R(t,n,o,s,a,c,E,f,d){r.info.render.vertices+=4;r.info.render.faces++;i(f.opacity);e(f.blending);if(f.map||f.envMap)T(t,n,s,0,1,3,E,f,d),T(a,o,c,1,2,3,E,f,d);else if(B=t.positionScreen.x,L=t.positionScreen.y,D=n.positionScreen.x,j=n.positionScreen.y,W=o.positionScreen.x,P=o.positionScreen.y,A=s.positionScreen.x,N=s.positionScreen.y,O=a.positionScreen.x,_=a.positionScreen.y,F=c.positionScreen.x,I=c.positionScreen.y,f instanceof THREE.MeshBasicMaterial)x(B,L,D,j,W,P,A,N),f.wireframe?yi(f.color,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):xi(f.color);
else if(f instanceof THREE.MeshLambertMaterial)ci?!f.wireframe&&f.shading==THREE.SmoothShading&&E.vertexNormalsWorld.length==4?(K.r=k.r=U.r=q.r=li.r,K.g=k.g=U.g=q.g=li.g,K.b=k.b=U.b=q.b=li.b,p(h,E.v1.positionWorld,E.vertexNormalsWorld[0],K),p(h,E.v2.positionWorld,E.vertexNormalsWorld[1],k),p(h,E.v4.positionWorld,E.vertexNormalsWorld[3],U),p(h,E.v3.positionWorld,E.vertexNormalsWorld[2],q),K.r=Math.max(0,Math.min(f.color.r*K.r,1)),K.g=Math.max(0,Math.min(f.color.g*K.g,1)),K.b=Math.max(0,Math.min(f.color.b*K.b,1)),k.r=Math.max(0,Math.min(f.color.r*k.r,1)),k.g=Math.max(0,Math.min(f.color.g*k.g,1)),k.b=Math.max(0,Math.min(f.color.b*k.b,1)),U.r=Math.max(0,Math.min(f.color.r*U.r,1)),U.g=Math.max(0,Math.min(f.color.g*U.g,1)),U.b=Math.max(0,Math.min(f.color.b*U.b,1)),q.r=Math.max(0,Math.min(f.color.r*q.r,1)),q.g=Math.max(0,Math.min(f.color.g*q.g,1)),q.b=Math.max(0,Math.min(f.color.b*q.b,1)),$=wi(K,k,U,q),y(B,L,D,j,A,N),Hi(B,L,D,j,A,N,0,0,1,0,0,1,$),y(O,_,W,P,F,I),Hi(O,_,W,P,F,I,1,0,1,1,0,1,$)):(Y.r=li.r,Y.g=li.g,Y.b=li.b,p(h,E.centroidWorld,E.normalWorld,Y),Y.r=Math.max(0,Math.min(f.color.r*Y.r,1)),Y.g=Math.max(0,Math.min(f.color.g*Y.g,1)),Y.b=Math.max(0,Math.min(f.color.b*Y.b,1)),x(B,L,D,j,W,P,A,N),f.wireframe?yi(Y,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):xi(Y)):(x(B,L,D,j,W,P,A,N),f.wireframe?yi(f.color,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):xi(f.color));else if(f instanceof THREE.MeshNormalMaterial)Y.r=bi(E.normalWorld.x),Y.g=bi(E.normalWorld.y),Y.b=bi(E.normalWorld.z),x(B,L,D,j,W,P,A,N),f.wireframe?yi(Y,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):xi(Y);else if(f instanceof THREE.MeshDepthMaterial)Q=l.near,Z=l.far,K.r=K.g=K.b=1-Mi(t.positionScreen.z,Q,Z),k.r=k.g=k.b=1-Mi(n.positionScreen.z,Q,Z),U.r=U.g=U.b=1-Mi(s.positionScreen.z,Q,Z),q.r=q.g=q.b=1-Mi(o.positionScreen.z,Q,Z),$=wi(K,k,U,q),y(B,L,D,j,A,N),Hi(B,L,D,j,A,N,0,0,1,0,0,1,$),y(O,_,W,P,F,I),Hi(O,_,W,P,F,I,1,0,1,1,0,1,$)}function y(t,i,e,n,o,r){u.beginPath();u.moveTo(t,i);u.lineTo(e,n);u.lineTo(o,r);u.lineTo(t,i);u.closePath()}function x(t,i,e,n,o,r,s,a){u.beginPath();u.moveTo(t,i);u.lineTo(e,n);u.lineTo(o,r);u.lineTo(s,a);u.lineTo(t,i);u.closePath()}function yi(t,i,e,o){if(v!=i)u.lineWidth=v=i;if(H!=e)u.lineCap=H=e;if(w!=o)u.lineJoin=w=o;n(t.getContextStyle());u.stroke();hi.inflate(i*2)}function xi(t){o(t.getContextStyle());u.fill()}function vi(t,i,e,n,r,s,a,h,c,l,E,p,f){if(f.image.width!=0){if(f.needsUpdate==!0||X[f.id]==void 0){var d=f.wrapS==THREE.RepeatWrapping,m=f.wrapT==THREE.RepeatWrapping;X[f.id]=u.createPattern(f.image,d&&m?"repeat":d&&!m?"repeat-x":!d&&m?"repeat-y":"no-repeat");f.needsUpdate=!1}o(X[f.id]);var d=f.offset.x/f.repeat.x,m=f.offset.y/f.repeat.y,g=f.image.width*f.repeat.x,T=f.image.height*f.repeat.y,a=(a+d)*g,h=(h+m)*T,c=(c+d)*g,l=(l+m)*T,E=(E+d)*g,p=(p+m)*T;e-=t;n-=i;r-=t;s-=i;c-=a;l-=h;E-=a;p-=h;d=c*p-E*l;if(d==0){if(G[f.id]==void 0)i=document.createElement("canvas"),i.width=f.image.width,i.height=f.image.height,t=i.getContext("2d"),t.drawImage(f.image,0,0),G[f.id]=t.getImageData(0,0,f.image.width,f.image.height).data,delete i;i=G[f.id];a=(Math.floor(a)+Math.floor(h)*f.image.width)*4;Y.setRGB(i[a]/255,i[a+1]/255,i[a+2]/255);xi(Y)}else d=1/d,f=(p*e-l*r)*d,l=(p*n-l*s)*d,e=(c*r-E*e)*d,n=(c*s-E*n)*d,t=t-f*a-e*h,a=i-l*a-n*h,u.save(),u.transform(f,l,e,n,t,a),u.fill(),u.restore()}}function Hi(t,i,e,n,o,r,s,a,h,c,l,E,p){var f,d;f=p.width-1;d=p.height-1;s*=f;a*=d;h*=f;c*=d;l*=f;E*=d;e-=t;n-=i;o-=t;r-=i;h-=s;c-=a;l-=s;E-=a;d=1/(h*E-l*c);f=(E*e-c*o)*d;c=(E*n-c*r)*d;e=(h*o-l*e)*d;n=(h*r-l*n)*d;t=t-f*s-e*a;i=i-c*s-n*a;u.save();u.transform(f,c,e,n,t,i);u.clip();u.drawImage(p,0,0);u.restore()}function wi(t,i,e,n){var o=~~(t.r*255),r=~~(t.g*255),t=~~(t.b*255),s=~~(i.r*255),a=~~(i.g*255),i=~~(i.b*255),h=~~(e.r*255),c=~~(e.g*255),e=~~(e.b*255),l=~~(n.r*255),E=~~(n.g*255),n=~~(n.b*255);gi[0]=o<0?0:o>255?255:o;gi[1]=r<0?0:r>255?255:r;gi[2]=t<0?0:t>255?255:t;gi[4]=s<0?0:s>255?255:s;gi[5]=a<0?0:a>255?255:a;gi[6]=i<0?0:i>255?255:i;gi[8]=h<0?0:h>255?255:h;gi[9]=c<0?0:c>255?255:c;gi[10]=e<0?0:e>255?255:e;gi[12]=l<0?0:l>255?255:l;gi[13]=E<0?0:E>255?255:E;gi[14]=n<0?0:n>255?255:n;ui.putImageData(mi,0,0);Ri.drawImage(di,0,0);return Ti}function Mi(t,i,e){t=(t-i)/(e-i);return t*t*(3-2*t)}function bi(t){t=(t+1)*.5;return t<0?0:t>1?1:t}function Si(t,i){var e=i.x-t.x,n=i.y-t.y,o=e*e+n*n;o!=0&&(o=1/Math.sqrt(o),e*=o,n*=o,i.x+=e,i.y+=n,t.x-=e,t.y-=n)}var zi,Vi,Ci,Bi;this.autoClear?this.clear():u.setTransform(1,0,0,-1,f,d);r.info.render.vertices=0;r.info.render.faces=0;s=c.projectScene(t,l,this.sortElements);a=s.elements;h=s.lights;(ci=h.length>0)&&E(h);zi=0;for(Vi=a.length;zi<Vi;zi++)if(Ci=a[zi],Bi=Ci.material,Bi=Bi instanceof THREE.MeshFaceMaterial?Ci.faceMaterial:Bi,!(Bi==null||Bi.opacity==0)){hi.empty();if(Ci instanceof THREE.RenderableParticle)M=Ci,M.x*=f,M.y*=d,m(M,Ci,Bi,t);else if(Ci instanceof THREE.RenderableLine)M=Ci.v1,b=Ci.v2,M.positionScreen.x*=f,M.positionScreen.y*=d,b.positionScreen.x*=f,b.positionScreen.y*=d,hi.addPoint(M.positionScreen.x,M.positionScreen.y),hi.addPoint(b.positionScreen.x,b.positionScreen.y),si.intersects(hi)&&g(M,b,Ci,Bi,t);else if(Ci instanceof THREE.RenderableFace3)M=Ci.v1,b=Ci.v2,S=Ci.v3,M.positionScreen.x*=f,M.positionScreen.y*=d,b.positionScreen.x*=f,b.positionScreen.y*=d,S.positionScreen.x*=f,S.positionScreen.y*=d,Bi.overdraw&&(Si(M.positionScreen,b.positionScreen),Si(b.positionScreen,S.positionScreen),Si(S.positionScreen,M.positionScreen)),hi.add3Points(M.positionScreen.x,M.positionScreen.y,b.positionScreen.x,b.positionScreen.y,S.positionScreen.x,S.positionScreen.y),si.intersects(hi)&&T(M,b,S,0,1,2,Ci,Bi,t);else if(Ci instanceof THREE.RenderableFace4)M=Ci.v1,b=Ci.v2,S=Ci.v3,z=Ci.v4,M.positionScreen.x*=f,M.positionScreen.y*=d,b.positionScreen.x*=f,b.positionScreen.y*=d,S.positionScreen.x*=f,S.positionScreen.y*=d,z.positionScreen.x*=f,z.positionScreen.y*=d,V.positionScreen.copy(b.positionScreen),C.positionScreen.copy(z.positionScreen),Bi.overdraw&&(Si(M.positionScreen,b.positionScreen),Si(b.positionScreen,z.positionScreen),Si(z.positionScreen,M.positionScreen),Si(S.positionScreen,V.positionScreen),Si(S.positionScreen,C.positionScreen)),hi.addPoint(M.positionScreen.x,M.positionScreen.y),hi.addPoint(b.positionScreen.x,b.positionScreen.y),hi.addPoint(S.positionScreen.x,S.positionScreen.y),hi.addPoint(z.positionScreen.x,z.positionScreen.y),si.intersects(hi)&&R(M,b,S,z,V,C,Ci,Bi,t);ai.addRectangle(hi)}u.setTransform(1,0,0,1,0,0)}};THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(t){this.positionWorld.copy(t.positionWorld);this.positionScreen.copy(t.positionScreen)};THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.centroidWorld=new THREE.Vector3;this.centroidScreen=new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.faceMaterial=this.material=null;this.uvs=[[]];this.z=null};THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.v4=new THREE.RenderableVertex;this.centroidWorld=new THREE.Vector3;this.centroidScreen=new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.faceMaterial=this.material=null;this.uvs=[[]];this.z=null};THREE.RenderableObject=function(){this.z=this.object=null};THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null;this.scale=new THREE.Vector2;this.material=null};THREE.RenderableLine=function(){this.z=null;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.material=null};Particle3D=function(t){THREE.Particle.call(this,t);this.velocity=new THREE.Vector3(0,-8,0);this.velocity.rotateX(randomRange(-45,45));this.velocity.rotateY(randomRange(0,360));this.gravity=new THREE.Vector3(0,0,0);this.drag=1};Particle3D.prototype=new THREE.Particle;Particle3D.prototype.constructor=Particle3D;Particle3D.prototype.updatePhysics=function(){this.velocity.multiplyScalar(this.drag);this.velocity.addSelf(this.gravity);this.position.addSelf(this.velocity)};var TO_RADIANS=Math.PI/180;THREE.Vector3.prototype.rotateY=function(t){cosRY=Math.cos(t*TO_RADIANS);sinRY=Math.sin(t*TO_RADIANS);var i=this.z;var e=this.x;this.x=e*cosRY+i*sinRY;this.z=e*-sinRY+i*cosRY};THREE.Vector3.prototype.rotateX=function(t){cosRY=Math.cos(t*TO_RADIANS);sinRY=Math.sin(t*TO_RADIANS);var i=this.z;var e=this.y;this.y=e*cosRY+i*sinRY;this.z=e*-sinRY+i*cosRY};THREE.Vector3.prototype.rotateZ=function(t){cosRY=Math.cos(t*TO_RADIANS);sinRY=Math.sin(t*TO_RADIANS);var i=this.x;var e=this.y;this.y=e*cosRY+i*sinRY;this.x=e*-sinRY+i*cosRY};function randomRange(t,i){return Math.random()*(i-t)+t}function DropRain(t){t=t||{};this.x2=-15;this.len=30;this.count=100;this.DropRain;this.canvas;this.ctx;this.Width=$(document).width();this.Height=$(document).height();this.init()}DropRain.prototype.init=function(){var t=this;var i=document.body;this.DropRain=document.createElement("div");this.DropRain.id="DropRain";this.DropRain.className="DropImgContainer-body";this.DropRain.style.margin="0px";this.DropRain.style.overflow="hidden";this.DropRain.style.pointerEvents="none";this.DropRain.style.position="absolute";this.DropRain.style.left="0px";this.DropRain.style.top="0px";this.DropRain.style.zIndex=999;i.appendChild(this.DropRain);this.canvas=document.createElement("canvas");this.canvas.id="canvas";this.canvas.width=i.offsetWidth;this.canvas.height=i.offsetHeight;this.DropRain.appendChild(this.canvas);this.ctx=this.canvas.getContext("2d");setInterval(function(){t.clearCanvas()},100)};DropRain.prototype.clearCanvas=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.loop()};DropRain.prototype.render=function(t,i){var e=this.ctx.createLinearGradient(t,i,t+this.x2,i+this.len);e.addColorStop(0,"rgba(0,0,0,0)");e.addColorStop(.5,"rgba(105,105,105,1)");e.addColorStop(1,"rgba(255,255,255,1)");this.ctx.strokeStyle=e;this.ctx.beginPath();this.ctx.moveTo(t,i);this.ctx.lineTo(t+this.x2,i+this.len);this.ctx.lineWidth=2;this.ctx.stroke();this.ctx.closePath()};DropRain.prototype.loop=function(){for(var t=1;t<=this.count;t++){this.render(Math.random()*this.Width,Math.random()*this.Height)}};var imgList={snow:["//gfs11.gomein.net.cn/T1OwJTB_Zj1RCvBVdK.png"],huaban:["//gfs13.gomein.net.cn/T1nSYTBgY_1RCvBVdK.png","//gfs12.gomein.net.cn/T1Fw_TBQDT1RCvBVdK.png","//gfs12.gomein.net.cn/T1VSDTBQYg1RCvBVdK.png","//gfs14.gomein.net.cn/T1ywdTBbKg1RCvBVdK.png","//gfs13.gomein.net.cn/T1PSETB7LQ1RCvBVdK.png","//gfs10.gomein.net.cn/T1pwKTBjJv1RCvBVdK.png","//gfs11.gomein.net.cn/T1eTxTBKhg1RCvBVdK.png","//gfs13.gomein.net.cn/T12T_TBgbT1RCvBVdK.png","//gfs12.gomein.net.cn/T1zTJTBjLj1RCvBVdK.png","//gfs10.gomein.net.cn/T1MTKTBjJv1RCvBVdK.png","//gfs13.gomein.net.cn/T1oTDTBQbg1RCvBVdK.png","//gfs14.gomein.net.cn/T1ZThTBKEj1RCvBVdK.png","//gfs12.gomein.net.cn/T1rSKTBgVv1RCvBVdK.png","//gfs13.gomein.net.cn/T1CwdTBbWg1RCvBVdK.png"],caidai:["//gfs13.gomein.net.cn/T1cSKTBCWv1RCvBVdK.png","//gfs13.gomein.net.cn/T16TKTBgVv1RCvBVdK.png","//gfs10.gomein.net.cn/T1wwKTBQbv1RCvBVdK.png","//gfs13.gomein.net.cn/T1cGWTBgWQ1RCvBVdK.png","//gfs13.gomein.net.cn/T19eZTBCZj1RCvBVdK.png","//gfs14.gomein.net.cn/T1bSDTBXCg1RCvBVdK.png","//gfs10.gomein.net.cn/T11w_TBCCT1RCvBVdK.png","//gfs10.gomein.net.cn/T1mwYTBKL_1RCvBVdK.png","//gfs11.gomein.net.cn/T1YS_TBCCT1RCvBVdK.png","//gfs13.gomein.net.cn/T18wDTB4Cg1RCvBVdK.png","//gfs12.gomein.net.cn/T13SKTBmWv1RCvBVdK.png","//gfs10.gomein.net.cn/T1KTCTBCZ_1RCvBVdK.png","//gfs14.gomein.net.cn/T1neZTB4bj1RCvBVdK.png","//gfs12.gomein.net.cn/T1GTYTByEg1RCvBVdK.png","//gfs13.gomein.net.cn/T1YwJTBgxj1RCvBVdK.png","//gfs13.gomein.net.cn/T1IeKTB5Lv1RCvBVdK.png"],fengye:["//gfs10.gomein.net.cn/T18TCTBCW_1RCvBVdK.png","//gfs10.gomein.net.cn/T1oT_TB5xT1RCvBVdK.png","//gfs11.gomein.net.cn/T1iwCTBQEv1RCvBVdK.png","//gfs14.gomein.net.cn/T19S_TB7YT1RCvBVdK.png","//gfs14.gomein.net.cn/T1yehTB4Ej1RCvBVdK.png","//gfs14.gomein.net.cn/T1.exTBXAj1RCvBVdK.png","//gfs11.gomein.net.cn/T1nehTBTEj1RCvBVdK.png","//gfs12.gomein.net.cn/T1wSETBThQ1RCvBVdK.png"]};function randomN(t,i){return parseInt(Math.random()*(t-i)+i)}function DropImg(t){t=t||{};this.target=document.getElementById(t.target)||document.body;this.FollowMouse=t.FollowMouse||0;this.DropName=t.DropName||"snow";this.Width=t.Width||"100%";this.Height=t.Height||"100%";this.Left=t.Left||"0px";this.Top=t.Top||"0px";if(t.DropName=="huaban"){t.Length=14}else if(t.DropName=="fengye"){t.Length=8}else if(t.DropName=="snow"){t.Length=1}else if(t.DropName=="caidai"){t.Length=16}else{t.Length=1}this.Length=t.Length;this.Num=t.Num||100;this.DropImgContainer=t.DropImgContainer;this.container;this.particle;this.camera;this.scene;this.renderer;this.mouseX=0;this.mouseY=0;this.windowHalfX=window.innerWidth/2;this.windowHalfY=window.innerHeight/2;this.particles=[];this.init()}DropImg.prototype.init=function(){var t=this;var i=document.createElement("div");i.className=this.DropImgContainer;i.style.pointerEvents="none";i.style.position="absolute";i.style.zIndex="999";i.style.top=this.Top;i.style.width=this.Width;i.style.height=this.Height;i.style.Left=this.Left;i.setAttribute("dropname",this.DropName+"-"+this.FollowMouse);if(this.target){this.target.appendChild(i)}else{document.body.appendChild(i)}this.container=document.createElement("div");this.container.className="container";this.container.style.margin="0px";this.container.style.overflow="hidden";this.container.style.pointerEvents="none";this.container.style.position="absolute";this.container.style.left="0px";this.container.style.top="0px";this.container.style.width="100%";this.container.style.height="100%";i.appendChild(this.container);this.camera=new THREE.PerspectiveCamera(75,i.offsetWidth/i.offsetHeight,1,1e4);this.camera.position.z=1e3;this.scene=new THREE.Scene;this.scene.add(this.camera);this.renderer=new THREE.CanvasRenderer;this.renderer.setSize(i.offsetWidth,i.offsetHeight);for(var e=0;e<this.Num;e++){var n=new Image;n.src="http:"+imgList[this.DropName][randomN(0,this.Length)];n.width="35px";n.height="35px";n.opacity=".1";var o=new THREE.ParticleBasicMaterial({map:new THREE.Texture(n)});this.particle=new Particle3D(o);this.particle.position.x=Math.random()*2e3-1e3;this.particle.position.y=Math.random()*2e3-1e3;this.particle.position.z=Math.random()*2e3-1e3;this.particle.scale.x=this.particle.scale.y=1.5;this.scene.add(this.particle);this.particles.push(this.particle)}this.container.innerHTML="";this.container.appendChild(this.renderer.domElement);if(this.FollowMouse==0){this.target.addEventListener("mousemove",function(i){t.onDocumentMouseMove(i)},false);this.target.addEventListener("touchstart",function(i){t.onDocumentTouchStart(i)},false);this.target.addEventListener("touchmove",function(i){t.onDocumentTouchMove(i)},false)}setInterval(function(){t.loop()},3e3/60)};DropImg.prototype.loop=function(){for(var i=0;i<this.particles.length;i++){var particle=this.particles[i];particle.updatePhysics();with(particle.position){if(y<-1e3)y+=2e3;if(x>1e3)x-=2e3;else if(x<-1e3)x+=2e3;if(z>1e3)z-=2e3;else if(z<-1e3)z+=2e3}}this.camera.position.x+=(this.mouseX-this.camera.position.x)*.05;this.camera.position.y+=(-this.mouseY-this.camera.position.y)*.05;this.camera.lookAt(this.scene.position);this.renderer.render(this.scene,this.camera)};DropImg.prototype.onDocumentMouseMove=function(t){this.mouseX=t.clientX-this.windowHalfX;this.mouseY=t.clientY-this.windowHalfY};DropImg.prototype.onDocumentTouchStart=function(t){if(t.touches.length==1){t.preventDefault();this.mouseX=t.touches[0].pageX-this.windowHalfX;this.mouseY=t.touches[0].pageY-this.windowHalfY}};DropImg.prototype.onDocumentTouchMove=function(t){if(t.touches.length==1){t.preventDefault();this.mouseX=t.touches[0].pageX-this.windowHalfX;this.mouseY=t.touches[0].pageY-this.windowHalfY}};function startBodyTexiao(){$(".DropImgContainer-body").remove();var t=$("#specially-effect-type").val();if(!t)return;if(t!="rain"){var i=$("#specially-effect-mousemove").val();new DropImg({DropName:t,Width:$("body").width()+"px",Height:$("body").height()+"px",DropImgContainer:"DropImgContainer-body",FollowMouse:i})}else{new DropRain}}function startModuleTexiao(){$(".texiao-module").each(function(){var t="DropImgContainer-"+$(this).attr("id");$("."+t).remove();var i=$(this).data("dropname");if(i){var e=$(this).attr("data-followmouse");new DropImg({DropName:i,Height:$(this).height()+"px",target:$(this).attr("id"),DropImgContainer:t,FollowMouse:e})}})}$(function(){$(".lyrow").css("position","relative");setTimeout(function(){var t=window.location.host;if(t.indexOf("prom")!=-1){startBodyTexiao();startModuleTexiao()}},1e3)});